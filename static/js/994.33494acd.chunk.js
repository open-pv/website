"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[994],{5994:function(e,t,n){n.r(t),n.d(t,{default:function(){return et}});var r=n(9439),o=n(2791),a=n(9230),i=n(9716),s=n.n(i),l=n(7762),c=n(4165),u=n(5861),d=n(5587),f=n.n(d),h=n(9970),p=n(7133),w=n(8615),v=n(3433),g=n(8351),m=n(6397);function x(e){var t=(0,r.Z)(e,3),n=t[0],o=t[1],a=t[2],i=m.clone(n),s=m.clone(o),l=m.clone(a);return m.lerp(i,n,o,.5),m.lerp(s,o,a,.5),m.lerp(l,a,n,.5),[[n,i,l],[o,s,i],[a,l,s],[i,s,l]]}function y(e,t){var n,r=[],o=(0,l.Z)(e);try{for(o.s();!(n=o.n()).done;)for(var a=[n.value];a.length>0;){var i=a.pop(),s=m.create(),c=m.create();m.sub(s,i[1],i[0]),m.sub(c,i[2],i[0]);var u=m.create();m.cross(u,s,c);var d,f,h=.5*m.len(u);if(d=m.dot(s,s),f=m.dot(c,c),h<=t&&Math.max(d,f)<=1)r.push(i);else{var p=x(i);a.push.apply(a,(0,v.Z)(p))}}}catch(w){o.e(w)}finally{o.f()}return r}var b=n(6590),_=null,T=null,E=null,S=null,A=new g.Raycaster,F=(new g.Vector2,null),M={x:0,y:0},R=[],C=[],P=[],L=[],D=[],I=10,B=1,U=3.75,N=!1,j=0,Z=50,V=null,z=null,k=null,O=null,G=null;function X(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=document.getElementsByClassName("three-viewer")[0];t.style.width="100%",t.style.height="450px",T=new g.WebGLRenderer({antialias:!0,alpha:!0}),!1!==e&&null!==E||((E=new g.PerspectiveCamera(45,t.clientWidth/t.clientHeight,1,1e3)).up=new g.Vector3(0,0,1)),T.setSize(t.clientWidth,t.clientHeight),t.replaceChild(T.domElement,t.firstChild),window.addEventListener("resize",(function(){T.setSize(t.clientWidth,t.clientHeight),E.aspect=t.clientWidth/t.clientHeight,E.updateProjectionMatrix()}),!1),(S=new b.o(E,T.domElement)).mouseButtons={LEFT:g.MOUSE.PAN,MIDDLE:g.MOUSE.DOLLY,RIGHT:g.MOUSE.ROTATE},S.screenSpacePanning=!1,S.maxPolarAngle=Math.PI/2,T.domElement.addEventListener("contextmenu",W,!1),_=new g.Scene,[{color:16777215,intensity:.25,position:[0,-.3,1]},{color:16777215,intensity:.1,position:[.3,-.3,1]},{color:16777215,intensity:.1,position:[-.3,-.3,1]}].forEach((function(e){var t,n=new g.DirectionalLight(e.color,e.intensity);(t=n.position).set.apply(t,(0,v.Z)(e.position)),_.add(n)})),_.add(new g.AmbientLight(16777215,1)),function(e){e.addEventListener("mousemove",Y,!1),window.addEventListener("keydown",H,!1)}(t),ne()}function W(e){e.preventDefault();var t=document.getElementsByClassName("three-viewer")[0].getBoundingClientRect(),n=new g.Vector2;n.x=(e.clientX-t.left)/t.width*2-1,n.y=-(e.clientY-t.top)/t.height*2+1,A.setFromCamera(n,E);var r=A.intersectObjects(_.children,!0);if(r.length>0){var o=r[0].point.clone(),a=(new g.Vector3).subVectors(E.position,S.target);V=S.target.clone(),z=o,k=E.position.clone(),O=o.clone().add(a),N=!0,j=performance.now()}}function Y(e){var t=document.getElementsByClassName("three-viewer")[0].getBoundingClientRect();M.x=(e.clientX-t.left)/t.width*2-1,M.y=-(e.clientY-t.top)/t.height*2+1,A.setFromCamera(M,E);var n=A.intersectObjects(_.children.filter((function(e){return!P.includes(e)})),!0);if(n.length>0){var r=n[0].point.clone();G?G.position.copy(r):(G=function(e){var t=new g.SphereGeometry(.05,16,16),n=new g.MeshBasicMaterial({color:255}),r=new g.Mesh(t,n);return r.position.copy(e),r}(r),_.add(G))}else G&&(_.remove(G),G=null);if(R.length>0){var o=A.intersectObjects(_.children,!0);if(o.length>0){var a=o[0].point.clone(),i=R[R.length-1],s=a.distanceTo(i);console.log("Distance to potential vertex:",s)}}}function H(e){"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&("Space"===e.code?(e.preventDefault(),function(){A.setFromCamera(M,E);var e=A.intersectObjects(_.children.filter((function(e){return!P.includes(e)})),!0);if(e.length>0){var t=e[0],n=t.face?t.point.clone().add(t.face.normal.clone().multiplyScalar(.1)):t.point.clone();R.push(n),C.push(function(e){var t=e.uv,n=e.object.material;if(n.map&&n.map.image&&t){var r=n.map.image,o=r.width,a=r.height,i=document.createElement("canvas");i.width=o,i.height=a;var s=i.getContext("2d");s.drawImage(r,0,0,o,a);var l=Math.floor(t.x*o),c=Math.floor((1-t.y)*a),u=s.getImageData(l,c,1,1).data;return new g.Color(u[0]/255,u[1]/255,u[2]/255)}if(n.color)return n.color.clone();return new g.Color(16777215)}(t)),console.log("Color at intersection:",C[C.length-1].getStyle()),F&&_.remove(F),F=function(e){var t=new g.SphereGeometry(.1,16,16),n=new g.MeshBasicMaterial({color:16711680}),r=new g.Mesh(t,n);return r.position.copy(e),r}(n),_.add(F),console.log("Cursor added at:",n)}else console.log("No intersection found")}()):"KeyP"===e.code?function(){if(R.length<3)return void console.log("Not enough points to create a polygon");var e=new g.BufferGeometry,t=[],n=[];R.forEach((function(e,r){t.push(e.x,e.y,e.z);var o=C[r];n.push(o.r,o.g,o.b)})),e.setAttribute("position",new g.Float32BufferAttribute(t,3)),e.setAttribute("color",new g.Float32BufferAttribute(n,3));var r=g.ShapeUtils.triangulateShape(R,[]).map((function(e){return{a:new g.Vector3(t[3*e[0]],t[3*e[0]+1],t[3*e[0]+2]),b:new g.Vector3(t[3*e[1]],t[3*e[1]+1],t[3*e[1]+2]),c:new g.Vector3(t[3*e[2]],t[3*e[2]+1],t[3*e[2]+2])}}));r=r.flatMap((function(e){return q(e,B)})),L=function(e,t,n){var r=[];return e.traverse((function(e){if(e.isMesh){var o=e.geometry;if(!o.isBufferGeometry)return;for(var a=o.attributes.position.array,i=o.attributes.color?o.attributes.color.array:null,s=o.intensities?o.intensities:null,l=function(){var e=new g.Vector3(a[c],a[c+1],a[c+2]),o=new g.Vector3(a[c+3],a[c+4],a[c+5]),l=new g.Vector3(a[c+6],a[c+7],a[c+8]),u=i?new g.Color(i[c],i[c+1],i[c+2]):new g.Color(1,1,1),d=i?new g.Color(i[c+3],i[c+4],i[c+5]):new g.Color(1,1,1),f=i?new g.Color(i[c+6],i[c+7],i[c+8]):new g.Color(1,1,1),h=s?s[c/3]:-1e3,p=s?s[c/3+1]:-1e3,w=s?s[c/3+2]:-1e3,v=1/0;if(t.forEach((function(t){var n=Math.min(t.distanceTo(e),t.distanceTo(o),t.distanceTo(l));n<v&&(v=n)})),v<n){var m=new g.Triangle(e,o,l).getNormal(new g.Vector3);r.push({vertices:[e,o,l],colors:[u,d,f],normal:m,intensities:[h,p,w]})}},c=0;c<a.length;c+=9)l()}})),console.log("Filtered polygons:",r),r}(_,R,I);var o=[],a=[],i=[],s=[];r.forEach((function(e){var t=o.length/3;o.push(e.a.x,e.a.y,e.a.z),o.push(e.b.x,e.b.y,e.b.z),o.push(e.c.x,e.c.y,e.c.z),a.push(t,t+1,t+2)}));for(var l=0;l<o.length;l+=3){var c=new g.Vector3(o[l],o[l+1],o[l+2]),u=J(c,L);if(u){var d=Q(c,u),f=ee(d,u),h=te(d,u);i.push(f.r,f.g,f.b),s.push(h)}else i.push(1,1,1),s.push(-1)}var p=function(e){var t=0;return e.forEach((function(e){t+=$(e)})),t}(r),w=function(e,t){for(var n=e.length/9,r=0,o=0,a=0;a<n;a++){var i={a:new g.Vector3(e[9*a],e[9*a+1],e[9*a+2]),b:new g.Vector3(e[9*a+3],e[9*a+4],e[9*a+5]),c:new g.Vector3(e[9*a+6],e[9*a+7],e[9*a+8]),intensities:[t[3*a],t[3*a+1],t[3*a+2]]},s=$(i);r+=K(i)*s,o+=s}var l=r/o;return console.log("Average Intensity:",l),l}(o,s),v=p*w*U;console.log("Polygon Area:",p),console.log("Polygon Intensity:",w),e.setAttribute("position",new g.Float32BufferAttribute(o,3)),e.setAttribute("color",new g.Float32BufferAttribute(i,3)),e.setIndex(a);var m=new g.MeshBasicMaterial({vertexColors:!0,side:g.DoubleSide}),x=new g.Mesh(e,m);_.add(x),P.push(x),console.log("Polygon created");var y=new g.EdgesGeometry(e),b=new g.LineBasicMaterial({color:0}),T=new g.LineSegments(y,b);_.add(T),P.push(T);var E=new g.WireframeGeometry(e),S=new g.LineBasicMaterial({color:13421772}),A=new g.LineSegments(E,S);_.add(A),P.push(A);var F=function(e){for(var t=e.length/3,n=new g.Vector3,r=0;r<t;r++)n.x+=e[3*r],n.y+=e[3*r+1],n.z+=e[3*r+2]+.2;return n.divideScalar(t),n}(o),M=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");n.width=640,n.height=128,r.font="55px Arial",r.fillStyle="white",r.fillStyle="rgba(0, 0, 0, 0.3)",r.fillRect(0,0,n.width,n.height);var o=e.split("\n");r.font="55px Arial",r.fillStyle="white",o.forEach((function(e,t){r.fillText(e,10,60+60*t)}));var a=new g.CanvasTexture(n),i=new g.SpriteMaterial({map:a,depthTest:!1}),s=new g.Sprite(i);return s.position.copy(t),s.scale.set(5,1,1),s.renderOrder=999,s}("Fl\xe4che: ".concat(p.toFixed(2)," qm\nJahresertrag:").concat(v.toFixed(1)," kWh"),F);_.add(M),P.push(M),R=[],C=[],D.push(v.toFixed(1))}():"KeyR"===e.code&&(P.forEach((function(e){return _.remove(e)})),P=[],R=[],C=[],D=[],console.log("Scene reset")))}function q(e,t){var n,r=e.a.distanceTo(e.b),o=e.b.distanceTo(e.c),a=e.c.distanceTo(e.a);return r>t||o>t||a>t?r>=o&&r>=a?(n=e.a.clone().add(e.b).multiplyScalar(.5),[].concat((0,v.Z)(q({a:e.a,b:n,c:e.c},t)),(0,v.Z)(q({a:n,b:e.b,c:e.c},t)))):o>=r&&o>=a?(n=e.b.clone().add(e.c).multiplyScalar(.5),[].concat((0,v.Z)(q({a:e.a,b:e.b,c:n},t)),(0,v.Z)(q({a:e.a,b:n,c:e.c},t)))):(n=e.c.clone().add(e.a).multiplyScalar(.5),[].concat((0,v.Z)(q({a:e.a,b:e.b,c:n},t)),(0,v.Z)(q({a:n,b:e.b,c:e.c},t)))):[e]}function K(e){var t=e.intensities;return(t[0]+t[1]+t[2])/3}function $(e){var t=e.a,n=e.b,r=e.c,o=(new g.Vector3).subVectors(n,t),a=(new g.Vector3).subVectors(r,t);return.5*(new g.Vector3).crossVectors(o,a).length()}function J(e,t){var n=null,o=1/0;return t.forEach((function(t){var a=(0,r.Z)(t.vertices,3),i=a[0],s=a[1],l=a[2],c=e.distanceTo(i)+e.distanceTo(s)+e.distanceTo(l);c<o&&(o=c,n=t)})),o>=I&&console.error("Error: Trying to create a polygon with a distance longer than the threshold (".concat(o,")")),n}function Q(e,t){var n=(0,r.Z)(t.vertices,3),o=n[0],a=(n[1],n[2],t.normal.clone().normalize()),i=(o.dot(a)-e.dot(a))/a.dot(a);return e.clone().add(a.clone().multiplyScalar(i))}function ee(e,t){var n=(0,r.Z)(t.vertices,3),o=n[0],a=n[1],i=n[2],s=t.normal.clone().normalize(),l=s.dot((new g.Vector3).crossVectors(a.clone().sub(o),i.clone().sub(o))),c=s.dot((new g.Vector3).crossVectors(a.clone().sub(e),i.clone().sub(e)))/l,u=s.dot((new g.Vector3).crossVectors(i.clone().sub(e),o.clone().sub(e)))/l,d=1-c-u,f=t.colors[0],h=t.colors[1],p=t.colors[2],w=c*f.r+u*h.r+d*p.r,v=c*f.g+u*h.g+d*p.g,m=c*f.b+u*h.b+d*p.b;return new g.Color(w,v,m)}function te(e,t){var n=(0,r.Z)(t.vertices,3),o=n[0],a=n[1],i=n[2],s=t.normal.clone().normalize(),l=s.dot((new g.Vector3).crossVectors(a.clone().sub(o),i.clone().sub(o))),c=s.dot((new g.Vector3).crossVectors(a.clone().sub(e),i.clone().sub(e)))/l,u=s.dot((new g.Vector3).crossVectors(i.clone().sub(e),o.clone().sub(e)))/l,d=1-c-u;return c*t.intensities[0]+u*t.intensities[1]+d*t.intensities[2]}function ne(){if(requestAnimationFrame(ne),N){var e=performance.now()-j,t=Math.min(e/Z,1);S.target.lerpVectors(V,z,t),E.position.lerpVectors(k,O,t),1===t&&(N=!1)}S.update(),T.render(_,E)}var re=n(3365),oe=n.n(re);function ae(e,t){for(var n=0;n<e.length;n++)e[n]+=t[n]}function ie(e){var t=[.2777273272234177,.005407344544966578,.3340998053353061],n=[.1050930431085774,1.404613529898575,1.384590162594685],r=[-.3308618287255563,.214847559468213,.09509516302823659],o=[-4.634230498983486,-5.799100973351585,-19.33244095627987],a=[6.228269936347081,14.17993336680509,56.69055260068105],i=[4.776384997670288,-13.74514537774601,-65.35303263337234],s=[-5.435455855934631,4.645852612178535,26.3124352495832];return[t[0]+e*(n[0]+e*(r[0]+e*(o[0]+e*(a[0]+e*(i[0]+e*s[0]))))),t[1]+e*(n[1]+e*(r[1]+e*(o[1]+e*(a[1]+e*(i[1]+e*s[1]))))),t[2]+e*(n[2]+e*(r[2]+e*(o[2]+e*(a[2]+e*(i[2]+e*s[2])))))]}function se(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=-1e6,o=t;o<e.length;o+=n)r=Math.max(e[o],r);return r}function le(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=1e6,o=t;o<e.length;o+=n)r=Math.min(e[o],r);return r}function ce(e,t,n,r,o,a,i,s){var l=t.length/9,c=e.length/3,u=document.getElementById("canvas").getContext("webgl2");u||alert("Your browser does not support WebGL2");var d="#version 300 es\n\t#define INFINITY         1000000.0\n\tprecision highp float;\n  precision mediump sampler3D;\n\n  uniform vec3 u_sun_direction;\n  uniform int textureWidth;\n  uniform int textureHeight;\n  uniform int textureDepth;\n  uniform float u_POINT_RADIUS;\n  uniform float u_MIN_DISTANCE;\n  uniform int MAX_STEPS;\n  uniform vec3 gridCellSizes;\n  uniform vec3 origin_offset;\n  uniform sampler3D u_grid;\n  uniform float scaleDown;\n  uniform int pointcloudShading;\n\n  uniform sampler2D u_triangles;\n\tuniform int textureWidthTris;\n\n\tin vec3 a_position;\n\tin vec3 a_normal;\n\n\tout vec4 outColor;\n\n\tvec3 cross1(vec3 a, vec3 b) {\n\t\tvec3 c = vec3(0, 0, 0);\n\t\tc.x = a[1] * b[2] - a[2] * b[1];\n\t\tc.y = a[2] * b[0] - a[0] * b[2];\n\t\tc.z = a[0] * b[1] - a[1] * b[0];\n\t\treturn c;\n\t}\n    \n  bool intersectRaySphere(vec3 rayOrigin, vec3 rayDir, vec3 sphereCenter, float sphereRadius) {\n      vec3 oc = sphereCenter - rayOrigin;\n      float b = dot(oc, rayDir);\n      float c = dot(oc, oc) - b*b;\n      return ((b > 0.)&&(c < sphereRadius * sphereRadius));\n  }\n\n  float TriangleIntersect( vec3 v0, vec3 v1, vec3 v2, vec3 rayOrigin, vec3 rayDirection, int isDoubleSided )\n\t{\n\t\tvec3 edge1 = v1 - v0;\n\t\tvec3 edge2 = v2 - v0;\n\n\t\tvec3 pvec = cross(rayDirection, edge2);\n\n\t\tfloat epsilon = 0.000001; // Add epsilon to avoid division by zero\n\t\tfloat det = dot(edge1, pvec);\n\t\tif (abs(det) < epsilon) // Check if det is too close to zero\n\t\t\treturn INFINITY;\n\n\t\tfloat inv_det = 1.0 / det;\n\t\tif ( isDoubleSided == 0 && det < 0.0 ) \n\t\t\treturn INFINITY;\n\t\t\n\t\tvec3 tvec = rayOrigin - v0;\n\t\tfloat u = dot(tvec, pvec) * inv_det;\n\t\tvec3 qvec = cross(tvec, edge1);\n\t\tfloat v = dot(rayDirection, qvec) * inv_det;\n\t\tfloat t = dot(edge2, qvec) * inv_det;\n\t\tfloat x = dot(pvec,pvec);\n\t\treturn (u < 0.0 || u > 1.0 || v < 0.0 || u + v > 1.0 || t <= 0.0) ? INFINITY : t;\n\t}\n\n\tfloat Calculate_Shading_at_Point_Triangles(vec3 vertex_position, vec3 sun_direction) {\n\t\tfloat d;\n\t\tfloat t = INFINITY;\n\t\tfloat shadow_value = 0.;\n    for (int i = 0; i < ".concat(l,"; i++) {\n\t\t\tint index = i * 3;\n\t\t\tint x = index % textureWidthTris;\n\t\t\tint y = index / textureWidthTris;\n\t\t\tvec3 v0 = texelFetch(u_triangles, ivec2(x, y), 0).rgb;\n\n\t\t\tindex = i * 3 + 1;\n\t\t\tx = index % textureWidthTris;\n\t\t\ty = index / textureWidthTris;\n\t\t\tvec3 v1 = texelFetch(u_triangles, ivec2(x, y), 0).rgb;\n\n\t\t\tindex = i * 3 + 2;\n\t\t\tx = index % textureWidthTris;\n\t\t\ty = index / textureWidthTris;\n\t\t\tvec3 v2 = texelFetch(u_triangles, ivec2(x, y), 0).rgb;\n\n\t\t\td = TriangleIntersect(v0, v1, v2, vertex_position, sun_direction, 1);\n\t\t\tif (d < t && abs(d)>0.0001) {\n\t\t\t\tshadow_value += 1.;\n\n\t\t}\n\t\t}\n\t\treturn shadow_value;\n\t}\n\n\tfloat Calculate_Shading_at_Point(vec3 vertex_position, vec3 sun_direction) {\n        vec3 ray = normalize(sun_direction);\n        vec3 step = sign(ray);\n        vec3 tMax = (step * (gridCellSizes - mod(vertex_position - origin_offset, gridCellSizes)) + gridCellSizes) / ray;\n        vec3 tDelta = step * gridCellSizes / ray;\n        float shadow_value = 0.;\n        ivec3 gridPos = ivec3((vertex_position - origin_offset) / gridCellSizes);\n        // if ((vertex_position.x < 10.) && (vertex_position.x > -10.) && (vertex_position.y < 10.) && (vertex_position.y > -10.)){\n        //     return true;\n        // }\n        // if (gridPos.x == 0){\n        //     return true;\n        // }\n        for (int i = 0; i < MAX_STEPS; i++) {\n            for (int j = 0; j < textureDepth; j++) {\n                vec4 point = texelFetch(u_grid, ivec3(gridPos.x, gridPos.y, j), 0);\n                vec3 pointPos = point.rgb * scaleDown + origin_offset;\n\n                if (dot(pointPos - vertex_position, pointPos - vertex_position) <= u_MIN_DISTANCE * u_MIN_DISTANCE ){\n                    continue;\n                }\n\n                if (pointPos.z > -10.){\n                    if (intersectRaySphere(vertex_position, ray, pointPos, u_POINT_RADIUS)) {\n                        shadow_value += 1.0;\n                    }\n                }\n                else{\n                  break;\n                }\n            }\n            int axis = (tMax.x < tMax.y) ? 0 : 1;\n            tMax[axis] += tDelta[axis];\n            gridPos[axis] += int(step[axis]);\n            if ((textureWidth <= gridPos.x) || (textureHeight <= gridPos.y) || (gridPos.x < 0) || (gridPos.y < 0)){\n                break;\n            }\n        }\n        return shadow_value;\n    }\n\n\tvoid main() {\n\t\tfloat shadow_value = Calculate_Shading_at_Point_Triangles(a_position.xyz, u_sun_direction);\n    \n    if (pointcloudShading > 0){\n      shadow_value += Calculate_Shading_at_Point(a_position.xyz, u_sun_direction);\n    }\n\t\tfloat intensity = ((shadow_value > 1.)?0.:(1.-shadow_value))*dot(a_normal.xyz, u_sun_direction);\n    intensity = (intensity < 0.)?0.:intensity;\n    outColor = vec4(intensity, intensity, intensity, intensity); // Not shadowed\n\t}"),f=u.getParameter(u.MAX_3D_TEXTURE_SIZE);console.log("Max 3D texture size: ",f);var h=null!=r?r.length:1,p=1,w=1,v=1,g=new Float32Array(1),m=1,x=[],y=[],b=0,_=0,T=0;if(null!=r){x=[le(r,0,3),le(r,1,3),se(r,0,3),se(r,1,3)],y=[le(r,2,3),se(r,2,3)],console.log(x),b=x[2]-x[0],_=x[3]-x[1],T=Math.sqrt(10*_*b/h),console.log("GRID CELL SIZE:",T),p=Math.ceil(b/T),v=Math.ceil(_/T);for(var E=new Int32Array(p*v),S=0;S<r.length;S+=3){var A=Math.floor((r[S]-x[0])/T);E[4*(Math.floor((r[S+1]-x[1])/T)*p+A)]+=1}var F=se(E,0,1);console.log("Maximal depth of texture: ".concat(F)),w=F,g=new Float32Array(p*v*F*4);for(var M=0;M<g.length;M++)g[M]=-100;m=1.2*Math.max(y[1]-y[0],_,b);for(M=0;M<r.length;M+=3)for(var R=Math.floor((r[M]-x[0])/T),C=Math.floor((r[M+1]-x[1])/T),P=0;P<w;P++){var L=4*(C*p+R+P*v*p);if(g[L+2]<0){g[L+0]=(r[M]-x[0])/m,g[L+1]=(r[M+1]-x[1])/m,g[L+2]=(r[M+2]-0)/m,g[L+3]=1;break}}}var D=de(u,u.VERTEX_SHADER,d),I=de(u,u.FRAGMENT_SHADER,"#version 300 es\n\tprecision highp float;\n\tvoid main() {\n\t}\n\t"),B=function(e,t,n,r){var o=e.createProgram();if(void 0===t||void 0===n)return window.setShowTooManyUniformsError(!0),"abortSimulation";if(e.attachShader(o,t),e.attachShader(o,n),e.transformFeedbackVaryings(o,r,e.SEPARATE_ATTRIBS),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS))return o;console.error(e.getProgramInfoLog(o)),e.deleteProgram(o)}(u,D,I,["outColor"]);if("abortSimulation"===B)return null;var U,N=fe(u,16*c),j=function(e,t){var n=e.createTransformFeedback();return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n),e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,0,t),n}(u,N),Z=u.getParameter(u.MAX_TEXTURE_SIZE),V=Math.min(3*l,12*Math.floor(Z/12)),z=Math.ceil(3*l/V);u.useProgram(B),U=new Float32Array(V*z*4);for(M=0;M<l;M++){var k=12*M%V,O=Math.floor(12*M/V)*V+k;for(P=0;P<3;P++)U[O+P]=t[9*M+P],U[O+P+4]=t[9*M+P+3],U[O+P+8]=t[9*M+P+6]}var G=u.createTexture();u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,G),u.texImage2D(u.TEXTURE_2D,0,u.RGBA32F,V,z,0,u.RGBA,u.FLOAT,U),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.bindTexture(u.TEXTURE_2D,null);var X=u.createTexture();u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_3D,X),u.texImage3D(u.TEXTURE_3D,0,u.RGBA32F,p,v,w,0,u.RGBA,u.FLOAT,g),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_R,u.CLAMP_TO_EDGE);var W=u.getUniformLocation(B,"u_triangles");u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,G),u.uniform1i(W,0);var Y=u.getUniformLocation(B,"pointcloudShading");u.uniform1i(Y,null!=r?1:0);var H=u.getUniformLocation(B,"textureWidth");u.uniform1i(H,p);var q=u.getUniformLocation(B,"textureHeight");u.uniform1i(q,v);var K=u.getUniformLocation(B,"textureDepth");u.uniform1i(K,w);var $=u.getUniformLocation(B,"u_POINT_RADIUS");u.uniform1f($,o);var J=u.getUniformLocation(B,"u_MIN_DISTANCE");u.uniform1f(J,a);var Q=u.getUniformLocation(B,"scaleDown");u.uniform1f(Q,m);var ee=u.getUniformLocation(B,"MAX_STEPS");u.uniform1i(ee,1e4);var te=u.getUniformLocation(B,"gridCellSizes");u.uniform3f(te,T,T,10);var ne=u.getUniformLocation(B,"origin_offset");u.uniform3f(ne,x[0],x[1],0);var re=u.getUniformLocation(B,"u_grid");u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_3D,X),u.uniform1i(re,1);var oe=u.getUniformLocation(B,"textureWidthTris");u.uniform1i(oe,V);var ie=u.getAttribLocation(B,"a_position"),ce=u.getAttribLocation(B,"a_normal"),we=u.createVertexArray();u.bindVertexArray(we);var ve=he(u,e,ie),ge=he(u,n,ce),xe=null;for(M=0;M<i;M++){var ye=u.getUniformLocation(B,"u_sun_direction"),be=me(1,s.lat,s.lon);u.uniform3fv(ye,be),pe(u,j,u.POINTS,c),null==xe?xe=ue(u,N,"shading",c).filter((function(e,t){return(t+1)%4===0})):ae(xe,ue(u,N,"shading",c).filter((function(e,t){return(t+1)%4===0})))}return u.deleteTexture(X),u.deleteShader(D),u.deleteShader(I),u.deleteProgram(B),u.deleteBuffer(ve),u.deleteBuffer(ge),u.deleteTransformFeedback(j),u.deleteBuffer(N),xe}function ue(e,t,n,r){var o=new Float32Array(4*r);return e.bindBuffer(e.ARRAY_BUFFER,t),e.getBufferSubData(e.ARRAY_BUFFER,0,o),e.bindBuffer(e.ARRAY_BUFFER,null),o}function de(e,t,n){var r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))return r;console.error(e.getShaderInfoLog(r)),e.deleteShader(r)}function fe(e,t){var n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW),n}function he(e,t,n){fe(e,t);e.enableVertexAttribArray(n),e.vertexAttribPointer(n,3,e.FLOAT,!1,0,0)}function pe(e,t,n,r){e.enable(e.RASTERIZER_DISCARD),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,t),e.beginTransformFeedback(e.POINTS),e.drawArrays(n,0,r),e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,0,null),e.disable(e.RASTERIZER_DISCARD)}var we,ve,ge;n(720);function me(e,t,n){for(var r=new Float32Array(3*e),o=0;o<e;){var a=new Date(2023,Math.floor(12*Math.random()),1+Math.floor(28*Math.random()),Math.floor(24*Math.random()),Math.floor(60*Math.random()),0,0),i=oe().getPosition(a,t,n);i.altitude<.1||i.altitude==Number.NaN||(r[3*o]=-Math.cos(i.altitude)*Math.sin(i.azimuth),r[3*o+1]=-Math.cos(i.altitude)*Math.cos(i.azimuth),r[3*o+2]=Math.sin(i.altitude),o+=1)}return r}function xe(e,t,n){return ye.apply(this,arguments)}function ye(){return ye=(0,u.Z)((0,c.Z)().mark((function e(t,n,r){var o,a,i,s,l,u,d,f,h,p,w,v,g,m,x,y,b,_,T,E,S;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=we.attributes.position.array,a=ve.attributes.position.array,i=ve.attributes.normal.array,(s=document.getElementById("status")).textContent="Simulating",s.hasChanged=!0,l=[],u=[],d={},f=0;f<a.length;f+=3)h=[a[f],a[f+1],a[f+2]].map((function(e){return parseFloat(e.toFixed(6))})),p=JSON.stringify(h),d.hasOwnProperty(p)||(d[p]=f/3,l.push(a[f],a[f+1],a[f+2]),u.push(i[f],i[f+1],i[f+2]));return w=new Float32Array(l.slice()),v=new Float32Array(u.slice()),.5,1,e.next=16,ce(w,o,v,n,.5,1,window.numSimulations,t);case 16:if(null!==(g=e.sent)){e.next=20;break}return window.setLoading(!1),e.abrupt("return",null);case 20:for(m=0;m<g.length;m++)x=[l[3*m],l[3*m+1],l[3*m+2]].map((function(e){return parseFloat(e.toFixed(6))})),y=JSON.stringify(x),d.hasOwnProperty(y)?d[y]=g[m]:console.error("Couldn't find indices for pointKey ".concat(y));for(b=new Array(a.length/3).fill(0),_=0;_<a.length;_+=3)T=[a[_],a[_+1],a[_+2]].map((function(e){return parseFloat(e.toFixed(6))})),E=JSON.stringify(T),d.hasOwnProperty(E)&&(b[_/3]=d[E]);S=new Float32Array(b),s.textContent="Simulation Done",s.hasChanged=!0,window.setLoading(!1),Ee(S,n,r);case 28:case"end":return e.stop()}}),e)}))),ye.apply(this,arguments)}function be(e,t){var n,r=y([[m.fromValues.apply(m,(0,v.Z)(e.slice(0,3))),m.fromValues.apply(m,(0,v.Z)(e.slice(3,6))),m.fromValues.apply(m,(0,v.Z)(e.slice(6,9)))]],t),o=[],a=(0,l.Z)(r);try{for(a.s();!(n=a.n()).done;){var i=n.value;o.push.apply(o,(0,v.Z)(i))}}catch(s){a.e(s)}finally{a.f()}return o}function _e(e,t){for(var n=e.attributes.position.array.slice(),r=[],o=[],a=0;a<n.length;a+=9){for(var i=!0,s=0;s<9;s+=3)(n[a+s]<-t||n[a+s]>t||n[a+s+1]<-t||n[a+s+1]>t)&&(i=!1);if(i){var l=m.fromValues.apply(m,(0,v.Z)(n.slice(a,a+3))),c=m.fromValues.apply(m,(0,v.Z)(n.slice(a+3,a+6))),u=m.fromValues.apply(m,(0,v.Z)(n.slice(a+6,a+9))),d=m.create();m.sub(d,c,l);var f=m.create();m.sub(f,u,l);var h=m.create();m.cross(h,d,f);var p=m.create();if(m.scale(p,h,1/m.len(h)),m.len(h)<.05)continue;for(s=0;s<9;s++)r.push(n[a+s]),o.push(p[s%3])}}var w=new g.BufferGeometry;return w.setAttribute("position",new g.BufferAttribute(new Float32Array(r),3)),w.setAttribute("normal",new g.BufferAttribute(new Float32Array(o),3)),w.attributes.position.needsUpdate=!0,w.attributes.normal.needsUpdate=!0,w}function Te(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window.numRadiusSimulation+20,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:window.numRadiusSimulation+70,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:window.numRadiusSimulation,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2;null;var s=function(e,t,n){var r;if(null==n){r=Number.POSITIVE_INFINITY;for(var o=0;o<e.attributes.position.array.length;o++){var a=e.attributes.position.getZ(o);a<r&&(r=a)}}else r=n;var i=e.attributes.position.array;for(o=0;o<i.length;o+=9)for(var s=0;s<9;s+=3)i[o+s]=i[o+s]-t[0],i[o+s+1]=i[o+s+1]-t[1],i[o+s+2]=i[o+s+2]-r;return r}(e,[Ae[0]-t[0],Ae[1]-t[1]],n);we=_e(e,r);var c=function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY,o=_e(e,n).attributes.position.array.slice(),a=[],i=[],s=[],c=[],u=0;u<o.length;u+=9){for(var d=!0,f=0;f<9;f+=3)(o[u+f]<-t||o[u+f]>t||o[u+f+1]<-t||o[u+f+1]>t)&&(d=!1);var h=m.fromValues.apply(m,(0,v.Z)(o.slice(u,u+3))),p=m.fromValues.apply(m,(0,v.Z)(o.slice(u+3,u+6))),w=m.fromValues.apply(m,(0,v.Z)(o.slice(u+6,u+9))),x=m.create();m.sub(x,p,h);var y=m.create();m.sub(y,w,h);var b=m.create();m.cross(b,x,y);var _=m.create();if(m.scale(_,b,1/m.len(b)),!(m.len(b)<.05))if(d){var T,E=be(o.slice(u,u+9),r),S=(0,l.Z)(E);try{for(S.s();!(T=S.n()).done;){var A=T.value;a.push(A[0]),a.push(A[1]),a.push(A[2]),i.push(_[0]),i.push(_[1]),i.push(_[2])}}catch(R){S.e(R)}finally{S.f()}}else for(f=0;f<9;f++)s.push(o[u+f]),c.push(_[f%3])}var F=new g.BufferGeometry;F.setAttribute("position",new g.BufferAttribute(new Float32Array(a),3)),F.setAttribute("normal",new g.BufferAttribute(new Float32Array(i),3)),F.attributes.position.needsUpdate=!0,F.attributes.normal.needsUpdate=!0;var M=new g.BufferGeometry;return M.setAttribute("position",new g.BufferAttribute(new Float32Array(s),3)),M.setAttribute("normal",new g.BufferAttribute(new Float32Array(c),3)),M.attributes.position.needsUpdate=!0,M.attributes.normal.needsUpdate=!0,{innerGeometry:F,outerGeometry:M}}(e,a,o,i);return ve=c.innerGeometry,ge=c.outerGeometry,0===ve.attributes.position.array.length&&(window.setLoading(!1),window.setShowErrorMessage(!0),window.setShowThreeViewer(!1)),s}function Ee(e,t,n){return Se.apply(this,arguments)}function Se(){return Se=(0,u.Z)((0,c.Z)().mark((function e(t,n,r){var o,a,i,s,l,u,d,f,h,p,w,v,m,x,y;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=r||null==E?{x:0,y:0,z:0}:{x:E.position.x,y:E.position.y,z:E.position.z},X(r),a=ve.attributes.position.array.length/3,i=new Float32Array(3*a),s=0;s<a;s++)l=ie(Math.min(1,t[s]/window.numSimulations/.6)),i[3*s]=l[0],i[3*s+1]=l[1],i[3*s+2]=l[2];if(ve.intensities=t,ve.setAttribute("color",new g.Float32BufferAttribute(i,3)),u=new g.MeshStandardMaterial({vertexColors:!0,side:g.DoubleSide,shininess:0,roughness:1}),d=new g.Mesh(ve,u),_.add(d),f=new g.MeshStandardMaterial({vertexColors:!1,side:g.DoubleSide,color:13745828,shininess:0,roughness:1}),h=new g.Mesh(ge,f),_.add(h),null!=n)for(p=new g.SphereGeometry(.1),w=new g.MeshBasicMaterial({color:10035746}),s=0;s<n.length;s++)s%100/100<window.pointsVisualizationRatio&&(v=n[s],(m=new g.Mesh(p,w)).position.set(v[0],v[1],v[2]),_.add(m));x=new g.Vector3,ve.computeBoundingBox(),ve.boundingBox.getCenter(x),r?E.position.set(0,-40,80):(console.log("Camera Rot",window.offsetPos[0],window.offsetPos[1]),E.position.set(o.x-window.offsetPos[0],o.y-window.offsetPos[1],o.z),window.offsetPos[0]=0,window.offsetPos[1]=0),y=function e(){requestAnimationFrame(e),S.update(),T.render(_,E)},window.setShowViridisLegend(!0),y();case 21:case"end":return e.stop()}}),e)}))),Se.apply(this,arguments)}var Ae,Fe=n(7834);function Me(e){if(e.byteLength<227)throw new Error("Invalid arrayBuffer length");var t=new DataView(e);return{pointDataRecordFormat:15&t.getUint8(104),pointDataRecordLength:t.getUint16(105,!0),pointDataOffset:t.getUint32(96,!0),pointCount:t.getUint32(107,!0),scale:[t.getFloat64(131,!0),t.getFloat64(139,!0),t.getFloat64(147,!0)],offset:[t.getFloat64(155,!0),t.getFloat64(163,!0),t.getFloat64(171,!0)],min:[t.getFloat64(187,!0),t.getFloat64(203,!0),t.getFloat64(219,!0)],max:[t.getFloat64(179,!0),t.getFloat64(195,!0),t.getFloat64(211,!0)]}}function Re(e,t,n){var r=[e[t],e[t+1],e[t+2],e[t+3]];return n||r.reverse(),(128&r[3]?-1:1)*((127&r[3])<<24|r[2]<<16|r[1]<<8|r[0])}function Ce(e,t,n){return Pe.apply(this,arguments)}function Pe(){return(Pe=(0,u.Z)((0,c.Z)().mark((function e(t,n,r){var o,a,i,s,u,d,f,h,p,w,v,g,m,x,y,b,_,T,E,S,A,F,M,R,C,P,L,D;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("LOADING!!!"),4e5,o=new Float32Array(12e5),a=0,i=(0,l.Z)(r),e.prev=5,i.s();case 7:if((s=i.n()).done){e.next=48;break}if(u=s.value,-1==(d=null!=window.lazFiles?window.lazFiles.indexOf(u):-1)){e.next=14;break}f=window.lazCache[d],e.next=23;break;case 14:return e.next=16,fetch("https://www.openpv.de/laser/".concat(u));case 16:return h=e.sent,e.next=19,h.arrayBuffer();case 19:f=e.sent,null==window.lazFiles&&(window.lazFiles=[],window.lazCache=[]),window.lazFiles.push(u),window.lazCache.push(f);case 23:return p=new Uint8Array(f),w=Me(f),w.pointDataRecordFormat,v=w.pointDataRecordLength,w.pointDataOffset,g=w.pointCount,m=w.scale,x=w.offset,y=w.min,b=w.max,console.log("Total Point Count: ",g),e.next=28,(0,Fe.createLazPerf)();case 28:_=e.sent,T=new _.LASZip,E=_._malloc(v),S=_._malloc(p.byteLength),_.HEAPU8.set(p,S),y[0]-=n[0],b[0]-=n[0],y[1]-=n[1],b[1]-=n[1],y[2]-=n[2],b[2]-=n[2],console.log("Mesh minmax",y,b),console.log("Offset Pos",n),A=new Uint8Array(_.HEAPU8.buffer,_.HEAPU8.byteOffset,v),new DataView(A.buffer,A.byteOffset,v),console.time("LoadingTime");try{for(T.open(S,p.byteLength),F=_.HEAPU8.byteOffset,M=0;M<g;++M)T.getPoint(E),R=F+E,C=Re(_.HEAPU8,R,!0)*m[0]+x[0]-n[0],P=Re(_.HEAPU8,R+4,!0)*m[1]+x[1]-n[1],L=Re(_.HEAPU8,R+8,!0)*m[2]+x[2]-n[2],C>-t&&C<t&&P>-t&&P<t&&(a>=o.length&&((D=new Float32Array(2*o.length)).set(o),o=D),o[a++]=C,o[a++]=P,o[a++]=L)}finally{_._free(S),_._free(E),T.delete()}console.timeEnd("LoadingTime");case 46:e.next=7;break;case 48:e.next=53;break;case 50:e.prev=50,e.t0=e.catch(5),i.e(e.t0);case 53:return e.prev=53,i.f(),e.finish(53);case 56:return console.log("Points loaded",a/3),o=o.subarray(0,a),e.abrupt("return",o);case 59:case"end":return e.stop()}}),e,null,[[5,50,53,56]])})))).apply(this,arguments)}function Le(e){return De.apply(this,arguments)}function De(){return(De=(0,u.Z)((0,c.Z)().mark((function e(t){var n,o,a,i,s,l,u,d;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!/^[-]?(\d+(\.\d+)?),\s*[-]?(\d+(\.\d+)?)$/.test(t)){e.next=7;break}return o=t.split(",").map((function(e){return parseFloat(e.trim())})),a=(0,r.Z)(o,2),i=a[0],s=a[1],n={lat:i,lon:s},e.abrupt("return",n);case 7:return l="https://nominatim.openstreetmap.org/search?format=json&q=".concat(t).concat("+Germany+Bavaria"),e.next=10,Ie(l);case 10:if(u=e.sent){e.next=17;break}return d=t.split(" ").join("+"),l="https://nominatim.openstreetmap.org/search?format=json&q=".concat(d),e.next=16,Ie(l);case 16:u=e.sent;case 17:return e.abrupt("return",u);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(e){return Be.apply(this,arguments)}function Be(){return(Be=(0,u.Z)((0,c.Z)().mark((function e(t){var n,r,o,a;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=document.getElementById("status"),e.prev=1,e.next=4,fetch(t);case 4:if((o=e.sent).ok){e.next=9;break}throw console.error("Check connection to Nominatim geocoder"),r.textContent="Connection to Adress Server failed",new Error("Request failed with status "+o.status);case 9:return e.next=11,o.json();case 11:if(0!==(a=e.sent).length){e.next=14;break}return e.abrupt("return",null);case 14:return n=a[0],e.abrupt("return",n);case 18:return e.prev=18,e.t0=e.catch(1),console.error("Error:",e.t0),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,18]])})))).apply(this,arguments)}function Ue(e,t,n){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,u.Z)((0,c.Z)().mark((function e(t,n,r){var o;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.mapLocationBaseChanged=!0,!n){e.next=8;break}return e.next=4,Le(t);case 4:o=e.sent,window.mapLocation=o,e.next=9;break;case 8:o=r;case 9:"undefined"!==typeof o&&null!=o?Oe(o,n):(window.setLoading(!1),window.setShowThreeViewer(!1),window.setShowErrorMessage(!0)),n&&(window.mapLocationChanged=!1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e,t){h.Z.defs("EPSG:25832","+proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs");var n=(0,h.Z)("EPSG:4326","EPSG:25832").forward([e,t]),o=(0,r.Z)(n,2),a=o[0],i=o[1];return Ae=[a,i]}function Ze(e,t){var n=2e3,r=100,o=je(e,t),a=o[0],i=o[1],s=2*Math.floor(a/n),l=2*Math.floor(i/n),c=a%n<r,u=a%n>1900,d=i%n<r,f=i%n>1900,h=["".concat(s,"_").concat(l,".zip")];return c&&h.push("".concat(s-2,"_").concat(l,".zip")),u&&h.push("".concat(s+2,"_").concat(l,".zip")),d&&h.push("".concat(s,"_").concat(l-2,".zip")),f&&h.push("".concat(s,"_").concat(l+2,".zip")),c&&d&&h.push("".concat(s-2,"_").concat(l-2,".zip")),c&&f&&h.push("".concat(s-2,"_").concat(l+2,".zip")),u&&d&&h.push("".concat(s+2,"_").concat(l-2,".zip")),u&&f&&h.push("".concat(s+2,"_").concat(l+2,".zip")),h}function Ve(e,t){var n=1e3,r=100,o=je(e,t),a=o[0],i=o[1],s=Math.floor(a/n),l=Math.floor(i/n),c=a%n<r,u=a%n>900,d=i%n<r,f=i%n>900,h=["".concat(s,"_").concat(l,".laz")];return c&&h.push("".concat(s-2,"_").concat(l,".laz")),u&&h.push("".concat(s+2,"_").concat(l,".laz")),d&&h.push("".concat(s,"_").concat(l-2,".laz")),f&&h.push("".concat(s,"_").concat(l+2,".laz")),c&&d&&h.push("".concat(s-2,"_").concat(l-2,".laz")),c&&f&&h.push("".concat(s-2,"_").concat(l+2,".laz")),u&&d&&h.push("".concat(s+2,"_").concat(l-2,".laz")),u&&f&&h.push("".concat(s+2,"_").concat(l+2,".laz")),h}function ze(e){for(var t=new Uint8Array(e),n=[],r=t.length-2;r>=0&&(10!==t[r]&&13!==t[r]);r--)n.unshift(String.fromCharCode(t[r]));var o=n.join("");return o=o.trim()}function ke(e){var t=e.match(/^;\s*offset\s*(-?\d+(?:\.\d+)?(?:e[-+]?\d+)?)\s*(-?\d+(?:\.\d+)?(?:e[-+]?\d+)?)\s*(-?\d+(?:\.\d+)?(?:e[-+]?\d+)?)\s*$/i),n=[0,0,0];return t?(console.log("Matches",t),n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])],console.log("Offsets:",n[0],n[1],n[2])):console.log("Invalid comment format"),n}function Oe(e){return Ge.apply(this,arguments)}function Ge(){return Ge=(0,u.Z)((0,c.Z)().mark((function e(t){var n,r,o,a,i,s,u,d,h,v,g,m,x,y,b,_,T,E,S,A,F,M,R,C,P=arguments;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=P.length>1&&void 0!==P[1]&&P[1],r="https://www.openpv.de/data/",0!=(o=Ze(Number(t.lon),Number(t.lat))).length){e.next=5;break}return e.abrupt("return");case 5:a=document.getElementById("status"),i=[],s=null,!1,u=null,console.log("Location",t),d=je(Number(t.lon),Number(t.lat)),h=(0,l.Z)(o),e.prev=13,h.s();case 15:if((v=h.n()).done){e.next=78;break}if(g=v.value,m=void 0,-1==(m=null!=window.stlFiles?window.stlFiles.indexOf(g):-1)){e.next=25;break}s=window.stlDataCached[m],!0,console.log("Use cached file!!"),e.next=55;break;case 25:return x=r+g,!1,a.textContent="Loading from "+x,e.prev=28,y=void 0,e.next=32,fetch(x);case 32:if((y=e.sent).ok){e.next=35;break}throw new Error("Request failed with status "+y.status);case 35:return e.next=37,y.arrayBuffer();case 37:return b=e.sent,_=new(f()),e.next=41,_.loadAsync(b);case 41:return T=_.file(Object.keys(_.files)[0]),e.next=44,T.async("arraybuffer");case 44:s=e.sent,null==window.stlFiles&&(window.stlFiles=[],window.stlDataCached=[]),window.stlFiles.push(g),window.stlDataCached.push(s),e.next=55;break;case 50:return e.prev=50,e.t0=e.catch(28),window.setLoading(!1),window.setShowErrorMessage(!0),e.abrupt("return");case 55:if(!s){e.next=75;break}if(E=(new w.j).parse(s),S=ze(s),A=ke(S),null==u?(u=A,A=[0,0,0]):(A=[A[0]-u[0],A[1]-u[1],A[2]-u[2]],E.translate(A[0],A[1],A[2])),console.log("OFFSETS",u,A),i.push(E),F=p.n4(i),M=Te(F,u),R=[d[0],d[1],M+u[2]],console.log("OffsetUTM32:",R),C=null,!window.enableLaserPoints){e.next=71;break}return e.next=70,Ce(50,R,Ve(Number(t.lon),Number(t.lat)));case 70:C=e.sent;case 71:null!=C&&console.log("Finished loading points ".concat(C.length)),xe(t,C,n),e.next=76;break;case 75:console.error("STL file not found in ZIP archive");case 76:e.next=15;break;case 78:e.next=83;break;case 80:e.prev=80,e.t1=e.catch(13),h.e(e.t1);case 83:return e.prev=83,h.f(),e.finish(83);case 86:case"end":return e.stop()}}),e,null,[[13,80,83,86],[28,50]])}))),Ge.apply(this,arguments)}var Xe=n(184);var We=function(){var e=(0,a.$G)(),t=e.t;return e.i18n,(0,Xe.jsx)("div",{style:{alignItems:"center"},children:(0,Xe.jsx)("p",{children:t("errorMessage.tooManyUniforms")})})};var Ye=function(){var e=(0,a.$G)(),t=e.t;return e.i18n,(0,Xe.jsxs)("div",{style:{alignItems:"center"},children:[(0,Xe.jsx)("p",{children:t("errorMessage.wrongAdress")}),(0,Xe.jsx)("img",{src:"images/googleMaps.gif",alt:"Showing how to get coordinates from Google Maps",style:{width:"100%",maxWidth:"500px"}})]})},He={display:"block",margin:"auto",borderColor:"red"};var qe=function(){var e=(0,o.useState)(""),t=(0,r.Z)(e,2),n=t[0],i=t[1],l=(0,o.useState)(!1),c=(0,r.Z)(l,2),u=c[0],d=c[1],f=(0,o.useState)(!1),h=(0,r.Z)(f,2),p=h[0],w=h[1],v=(0,o.useState)(!1),g=(0,r.Z)(v,2),m=g[0],x=g[1],y=(0,a.$G)(),b=y.t,_=(y.i18n,(0,o.useState)(!1)),T=(0,r.Z)(_,2),E=T[0],S=T[1];return window.setShowErrorMessage=w,window.setShowTooManyUniformsError=S,window.setLoading=d,(0,Xe.jsxs)(Xe.Fragment,{children:[(0,Xe.jsxs)("form",{onSubmit:function(e){d(!u),window.setShowViridisLegend(!1),e.preventDefault(),window.setShowThreeViewer(!0),Ue(n,m,window.mapLocation),window.numRadiusSimulationChanged=!1,window.numSimulationsChanged=!1,window.mapLocationChanged=!1,w(!1),S(!1),x(!1)},style:{display:"flex",alignItems:"center"},id:"search-field",children:[(0,Xe.jsx)("input",{type:"text",placeholder:b("searchField.placeholder"),value:n,onChange:function(e){n!=e.target.value&&(i(e.target.value),x(!0))}}),(0,Xe.jsx)("button",{type:"submit",children:"Start"})]}),p&&(0,Xe.jsx)(Ye,{}),E&&(0,Xe.jsx)(We,{}),(0,Xe.jsx)(s(),{color:"MediumAquaMarine",cssOverride:He,loading:u,size:60}),window.enableLaserPoints&&u&&(0,Xe.jsx)("div",{style:{padding:"30px"},children:(0,Xe.jsx)("p",{style:{textAlign:"center"},children:b("loadingMessage.warningUseLaserpoints")})}),!window.enableLaserPoints&&u&&(0,Xe.jsx)("div",{style:{padding:"30px"},children:(0,Xe.jsx)("p",{style:{textAlign:"center"},children:b("loadingMessage.warningUseNoLaserpoints")})})]})},Ke=n(4666);function $e(){var e=(0,o.useState)([0,0]),t=(0,r.Z)(e,2),n=t[0],a=t[1],i=(0,o.useState)(!1),s=(0,r.Z)(i,2),l=s[0],c=s[1];null==window.offsetPos&&(window.offsetPos=[0,0]);var u=function(e,t){var r=[0,0];if(window.mapLocationBaseChanged?(a(0,0),r=[-n[0],-n[1]],window.mapLocationBaseChanged=!1):r=[0,0],null!=window.mapLocation){var o=window.distanceStep,i=Math.atan2(E.rotation.y,E.rotation.x),s={x:e*o*Math.cos(i)-t*o*Math.sin(i),y:t*o*Math.cos(i)+e*o*Math.sin(i)},l=[n[0]+s.x+r[0],n[1]+s.y+r[1]];window.offsetPos=l,console.log("Old offset pos",window.offsetPos),a([l[0],l[1]]);var c={lon:window.mapLocation.lon,lat:window.mapLocation.lat},u={lon:parseFloat(c.lon),lat:parseFloat(c.lat)};u.lon+=360*s.x/4e7/Math.cos(u.lat/180*Math.PI),u.lat+=360*s.y/4e7,u={lat:u.lat.toString(),lon:u.lon.toString()},window.mapLocation=u,window.mapLocationChanged=!0,E.position.set(E.position.x+s.x,E.position.y+s.y,E.position.z),E.lookAt(l[0],l[1],0),S.target.set(l[0],l[1],0);!function e(){requestAnimationFrame(e),S.update(),T.render(_,E)}(),function(e){var t=new g.CylinderGeometry(.25,.25,100,32),n=new g.MeshBasicMaterial({color:8947848}),r=new g.Mesh(t,n);r.position.set(e[0],e[1],50),r.rotation.set(Math.PI/2,0,0),_.add(r),function e(){r.scale.y>.1?(r.scale.y*=.95,r.position.z=100*r.scale.y/2,n.color.lerp(new g.Color(12303291),.04),setTimeout(e,20)):(_.remove(r),r.geometry.dispose(),r.material.dispose())}()}(l)}};return(0,Xe.jsxs)("div",{className:"viewer-container",style:{position:"relative"},children:[(0,Xe.jsx)(Ke.Xz,{className:"three-viewer",flat:!0,linear:!0}),(0,Xe.jsx)("canvas",{id:"canvas",width:0,height:0}),window.showViridisLegend&&(0,Xe.jsxs)("div",{style:{position:"absolute",left:0,bottom:0,margin:"10px"},children:[(0,Xe.jsxs)("p",{style:{fontSize:"8px"},children:[(0,Xe.jsx)("a",{href:"https://geodaten.bayern.de/opengeodata/",children:"Geb\xe4udedaten"})," der",(0,Xe.jsx)("a",{href:"https://www.ldbv.bayern.de/vermessung/bvv.html",children:" Bayerischen Vermessungsverwaltung "})," |",(0,Xe.jsx)("a",{href:"https://creativecommons.org/licenses/by/4.0/deed.de",children:"CC BY 4.0"})]}),(0,Xe.jsxs)("p",{children:[(0,Xe.jsx)("b",{children:"Leertaste"}),": Eckpunkt ",(0,Xe.jsx)("b",{children:"P"}),": Polygon erstellen ",(0,Xe.jsx)("b",{children:"B"}),": Alles zur\xfccksetzen"]})]}),window.showViridisLegend&&(0,Xe.jsxs)(Xe.Fragment,{children:[(0,Xe.jsx)("button",{className:"arrowButton",onClick:function(){return u(0,1)},style:{right:"1em",bottom:"2em"},children:(0,Xe.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[(0,Xe.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),(0,Xe.jsx)("polyline",{points:"5 12 12 5 19 12"})]})}),(0,Xe.jsx)("button",{className:"arrowButton",onClick:function(){return u(0,-1)},style:{right:"1em",bottom:"0em"},children:(0,Xe.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",style:{transform:"rotate(180deg)"},children:[(0,Xe.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),(0,Xe.jsx)("polyline",{points:"5 12 12 5 19 12"})]})}),(0,Xe.jsx)("button",{className:"arrowButton",onClick:function(){c(!l),window.setShowViridisLegend(!1),window.setShowThreeViewer(!0),Ue("",!1,window.mapLocation),window.numRadiusSimulationChanged=!1,window.numSimulationsChanged=!1,window.mapLocationChanged=!1,setShowErrorMessage(!1),setShowTooManyUniformsError(!1)},style:{right:"1em",bottom:"1em"},children:(0,Xe.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"50",height:"50",viewBox:"0 0 50 50",children:(0,Xe.jsx)("polyline",{points:"10,25 20,35 40,15",stroke:"#000000",strokeWidth:"0.5em",fill:"none"})})}),(0,Xe.jsx)("button",{className:"arrowButton",onClick:function(){return u(-1,0)},style:{right:"2em",bottom:"1em"},children:(0,Xe.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",style:{transform:"rotate(270deg)"},children:[(0,Xe.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),(0,Xe.jsx)("polyline",{points:"5 12 12 5 19 12"})]})}),(0,Xe.jsx)("button",{className:"arrowButton",onClick:function(){return u(1,0)},style:{right:"0em",bottom:"1em"},children:(0,Xe.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",style:{transform:"rotate(90deg)"},children:[(0,Xe.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),(0,Xe.jsx)("polyline",{points:"5 12 12 5 19 12"})]})})]})]})}var Je=function(){return(0,Xe.jsx)("img",{src:"images/viridis_legend.svg",alt:"Legend of the viridis colormap",style:{opacity:.6},width:"100%"})},Qe=n(1388);var et=function(){var e=(0,o.useState)(!0),t=(0,r.Z)(e,2),n=t[0],a=t[1],i=(0,o.useState)(!1),s=(0,r.Z)(i,2),l=s[0],c=s[1];return window.setShowThreeViewer=a,window.setShowViridisLegend=c,window.showViridisLegend=l,(0,Xe.jsx)(Qe.Z,{description:"Berechne das Potential deiner Solaranlage.",children:(0,Xe.jsxs)("article",{className:"post",id:"index",children:[(0,Xe.jsx)("header",{children:(0,Xe.jsx)("div",{className:"title",children:(0,Xe.jsx)(qe,{})})}),n&&(0,Xe.jsx)($e,{}),l&&(0,Xe.jsx)(Je,{})]})})}}}]);
//# sourceMappingURL=994.33494acd.chunk.js.map