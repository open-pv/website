{"version":3,"file":"static/js/346.e7df65a5.chunk.js","mappings":"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","sources":["simulation/stlviewer.js","simulation/stl_to_array.js","simulation/utils.js","simulation/webgl_raytracing.js","simulation/pv_simulation.js","simulation/download.js","components/ErrorMessages/WrongAdress.js","components/ErrorMessages/TooManyUniforms.js","components/PVSimulation/SearchField.js","components/ThreeViewer/ThreeViewer.js","components/ThreeViewer/ViridisLegend.js","pages/Index.js"],"sourcesContent":["import * as THREE from \"three\";\nimport { MapControls } from \"three/addons/controls/MapControls.js\";\n\nexport var scene = null;\nexport var renderer = null;\nexport var camera = null;\nexport var controls = null;\n\nexport function STLViewerEnable(classname) {\n  var model = document.getElementsByClassName(classname)[0];\n  STLViewer(model);\n}\n\nexport function STLViewer(resetCamera = true) {\n  const elem = document.getElementsByClassName(\"three-viewer\")[0];\n\n  elem.style.width = \"100%\";\n  elem.style.height = \"400px\";\n\n  renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });\n\n  //   if (camera != null) {\n  //     console.log(\"ResetCamera\", resetCamera);\n  //     console.log(\"CameraPos\", camera.position);\n  //     console.log(\"CameraRotation\", camera.rotation);\n  //   }\n  if (resetCamera == false || camera == null) {\n    camera = new THREE.PerspectiveCamera(\n      45,\n      elem.clientWidth / elem.clientHeight,\n      1,\n      1000\n    );\n    camera.up = new THREE.Vector3(0, 0, 1);\n  }\n  renderer.setSize(elem.clientWidth, elem.clientHeight);\n  elem.replaceChild(renderer.domElement, elem.firstChild);\n\n  window.addEventListener(\n    \"resize\",\n    function () {\n      renderer.setSize(elem.clientWidth, elem.clientHeight);\n      camera.aspect = elem.clientWidth / elem.clientHeight;\n      camera.updateProjectionMatrix();\n    },\n    false\n  );\n\n  controls = new MapControls(camera, renderer.domElement);\n  controls.mouseButtons = {\n    LEFT: THREE.MOUSE.PAN,\n    MIDDLE: THREE.MOUSE.DOLLY,\n    RIGHT: THREE.MOUSE.ROTATE,\n  };\n  controls.screenSpacePanning = false;\n  controls.maxPolarAngle = Math.PI / 2;\n\n  scene = new THREE.Scene();\n\n  let dirLight = new THREE.DirectionalLight(0xffffff, 0.25);\n  dirLight.position.set(0, -0.3, 1);\n  scene.add(dirLight);\n\n  let dirLight2 = new THREE.DirectionalLight(0xffffff, 0.1);\n  dirLight2.position.set(0.3, -0.3, 1);\n  scene.add(dirLight2);\n\n  let dirLight3 = new THREE.DirectionalLight(0xffffff, 0.1);\n  dirLight3.position.set(-0.3, -0.3, 1);\n  scene.add(dirLight3);\n  scene.add(new THREE.AmbientLight(0xffffff, 1));\n}\n","import { vec3 } from \"gl-matrix\";\n// const { vec3, mat4 } = glMatrix;\n\n\nexport function loadSTL(model) {\n    return new Promise((resolve, reject) => {\n        (new THREE.STLLoader()).load(model, function (geometry) {\n            // Extract the position and normal arrays from the geometry\n            const positionArray = geometry.attributes.position.array;\n            //const normalArray = geometry.attributes.normal.array;\n\n            const triangles = [];\n\n            for (let i = 0; i < positionArray.length; i += 9) {\n                const triangle = [\n                    Array.from(positionArray.slice(i, i + 3)),\n                    Array.from(positionArray.slice(i + 3, i + 6)),\n                    Array.from(positionArray.slice(i + 6, i + 9)),\n                ];\n    \n                triangles.push(triangle.map(v => vec3.fromValues(...v)));\n            }\n    \n            const threshold = 0.1; // Set your desired threshold value here\n            const subdividedTriangles = adaptiveSubdivideMesh(triangles, threshold);\n            \n\n\n            // Return the arrays in an object\n            resolve({ original_vertices: positionArray,subdivided_triangles:subdividedTriangles});\n        }, undefined, reject);\n    });\n}\n\n\n\n\nexport function subdivideTriangle(triangle) {\n    const [v0, v1, v2] = triangle;\n\n    const m01 = vec3.clone(v0);\n    const m12 = vec3.clone(v1);\n    const m20 = vec3.clone(v2);\n\n    vec3.lerp(m01, v0, v1, 0.5);\n    vec3.lerp(m12, v1, v2, 0.5);\n    vec3.lerp(m20, v2, v0, 0.5);\n\n    return [\n        [v0, m01, m20],\n        [v1, m12, m01],\n        [v2, m20, m12],\n        [m01, m12, m20],\n    ];\n}\n\n\nexport function adaptiveSubdivideMesh(triangles, threshold) {\n    const subdividedTrianglesList = [];\n\n    for (const triangle of triangles) {\n        let trianglesToSubdivide = [triangle];\n\n        while (trianglesToSubdivide.length > 0) {\n            const currentTriangle = trianglesToSubdivide.pop();\n\n            const edge1 = vec3.create();\n            const edge2 = vec3.create();\n\n            vec3.sub(edge1, currentTriangle[1], currentTriangle[0]);\n            vec3.sub(edge2, currentTriangle[2], currentTriangle[0]);\n\n            const crossProduct = vec3.create();\n            vec3.cross(crossProduct, edge1, edge2);\n            const area = 0.5 * vec3.len(crossProduct);\n\n            let lengthEdge1;\n            let lengthEdge2;\n\n            lengthEdge1 = vec3.dot(edge1, edge1);\n            lengthEdge2 = vec3.dot(edge2, edge2);\n\n\n            if (area <= threshold && Math.max(lengthEdge1, lengthEdge2) <= 1) {\n                subdividedTrianglesList.push(currentTriangle);\n            } else {\n                const subdividedTriangles = subdivideTriangle(currentTriangle);\n                trianglesToSubdivide.push(...subdividedTriangles);\n            }\n        }\n    }\n\n    return subdividedTrianglesList;\n\n}\n\n\n","export function addToArray(ar1, ar2){\n    for (var i = 0; i < ar1.length; i++){\n      ar1[i] += ar2[i];\n    }\n  }\n\n\n\n  // from https://observablehq.com/@flimsyhat/webgl-color-maps\nexport function intensity_colormap(t){\n  //viridis\n  const c0 = [0.2777273272234177, 0.005407344544966578, 0.3340998053353061];\n  const c1 = [0.1050930431085774, 1.404613529898575, 1.384590162594685];\n  const c2 = [-0.3308618287255563, 0.214847559468213, 0.09509516302823659];\n  const c3 = [-4.634230498983486, -5.799100973351585, -19.33244095627987];\n  const c4 = [6.228269936347081, 14.17993336680509, 56.69055260068105];\n  const c5 = [4.776384997670288, -13.74514537774601, -65.35303263337234];\n  const c6 = [-5.435455855934631, 4.645852612178535, 26.3124352495832];\n    \n    \n    //const res = c0*0.004+t*(c1+t*(c2+t*(c3+t*(c4+t*(c5+t*c6)))))*0.004;\n    const res = [\n      c0[0]+t*(c1[0]+t*(c2[0]+t*(c3[0] + t*(c4[0] + t*(c5[0] + t*c6[0]))))),\n      c0[1]+t*(c1[1]+t*(c2[1]+t*(c3[1] + t*(c4[1] + t*(c5[1] + t*c6[1]))))),\n      c0[2]+t*(c1[2]+t*(c2[2]+t*(c3[2] + t*(c4[2] + t*(c5[2] + t*c6[2])))))];\n    return res;\n}\n\n\n\nexport function deleteChildDivs(parentDivClass) {\n  let parentDiv =  document.getElementsByClassName(parentDivClass);\n  for (var i = 0; i < parentDiv.length; i++) {\n    let div = parentDiv[i];\n\n    // Remove all child elements by setting innerHTML to an empty string\n    div.innerHTML = '';\n  }\n}","import { addToArray } from \"./utils\";\nimport { retrieveRandomSunDirections } from \"./pv_simulation\";\n\nexport function rayTracingWebGL(\n  pointsArray,\n  trianglesArray,\n  normals,\n  num_dates,\n  loc\n) {\n  const N_TRIANGLES = trianglesArray.length / 9;\n\n  const width = pointsArray.length / 3; // Change this to the number of horizontal points in the grid\n  const height = 1; // Change this to the number of vertical points in the grid\n  const N_POINTS = width;\n  const canvas = document.getElementById(\"canvas\");\n\n  //canvas.width = width;\n  //canvas.height = height;\n\n  const gl = canvas.getContext(\"webgl2\");\n\n  if (!gl) {\n    alert(\"Your browser does not support WebGL2\");\n  }\n\n  // Vertex shader code\n  const vertexShaderSource = `#version 300 es\n\t#define INFINITY         1000000.0\n\tprecision highp float;\n\n\n\tuniform sampler2D u_triangles;\n\tuniform vec3 u_sun_direction;\n  \tuniform int textureWidth;\n\n\tin vec3 a_position;\n\tin vec3 a_normal;\n\n\tout vec4 outColor;\n\n\tvec3 cross1(vec3 a, vec3 b) {\n\t\tvec3 c = vec3(0, 0, 0);\n\t\tc.x = a[1] * b[2] - a[2] * b[1];\n\t\tc.y = a[2] * b[0] - a[0] * b[2];\n\t\tc.z = a[0] * b[1] - a[1] * b[0];\n\t\treturn c;\n\t}\n\n\tfloat TriangleIntersect( vec3 v0, vec3 v1, vec3 v2, vec3 rayOrigin, vec3 rayDirection, int isDoubleSided )\n\t{\n\t\tvec3 edge1 = v1 - v0;\n\t\tvec3 edge2 = v2 - v0;\n\n\t\tvec3 pvec = cross(rayDirection, edge2);\n\n\t\tfloat epsilon = 0.000001; // Add epsilon to avoid division by zero\n\t\tfloat det = dot(edge1, pvec);\n\t\tif (abs(det) < epsilon) // Check if det is too close to zero\n\t\t\treturn INFINITY;\n\n\t\tfloat inv_det = 1.0 / det;\n\t\tif ( isDoubleSided == 0 && det < 0.0 ) \n\t\t\treturn INFINITY;\n\t\t\n\t\tvec3 tvec = rayOrigin - v0;\n\t\tfloat u = dot(tvec, pvec) * inv_det;\n\t\tvec3 qvec = cross(tvec, edge1);\n\t\tfloat v = dot(rayDirection, qvec) * inv_det;\n\t\tfloat t = dot(edge2, qvec) * inv_det;\n\t\tfloat x = dot(pvec,pvec);\n\t\treturn (u < 0.0 || u > 1.0 || v < 0.0 || u + v > 1.0 || t <= 0.0) ? INFINITY : t;\n\n\t}\n\n\n\tbool Calculate_Shading_at_Point(vec3 vertex_position, vec3 sun_direction) {\n\t\tfloat d;\n\t\tfloat t = INFINITY;\n\t\tbool is_shadowed = false;\n\t\tfor (int i = 0; i < ${N_TRIANGLES}; i++) {\n\t\t\tint index = i * 3;\n\t\t\tint x = index % textureWidth;\n\t\t\tint y = index / textureWidth;\n\t\t\tvec3 v0 = texelFetch(u_triangles, ivec2(x, y), 0).rgb;\n\n\t\t\tindex = i * 3 + 1;\n\t\t\tx = index % textureWidth;\n\t\t\ty = index / textureWidth;\n\t\t\tvec3 v1 = texelFetch(u_triangles, ivec2(x, y), 0).rgb;\n\n\t\t\tindex = i * 3 + 2;\n\t\t\tx = index % textureWidth;\n\t\t\ty = index / textureWidth;\n\t\t\tvec3 v2 = texelFetch(u_triangles, ivec2(x, y), 0).rgb;\n\t\t\td = TriangleIntersect(v0, v1, v2, vertex_position, sun_direction, 1);\n\t\t\tif (d < t && abs(d)>0.0001) {\n\t\t\t\treturn true;\n\n\t\t}\n\t\t}\n\t\treturn is_shadowed;\n\t}\n\n\tvoid main() {\n\t\tif (Calculate_Shading_at_Point(a_position.xyz, u_sun_direction)) {\n\t\t\t\t\toutColor = vec4(0, 0, 0, 0); // Shadowed\n\t\t\t\t} else {\n\t\t\t\t\tfloat intensity = abs(dot(a_normal.xyz, u_sun_direction));\n\t\t\t\t\toutColor = vec4(intensity, intensity, intensity, intensity); // Not shadowed\n\t\t\t\t}\n\n\t}`;\n\n  // Fragment shader code\n  const fragmentShaderSource = `#version 300 es\n\tprecision highp float;\n\tvoid main() {\n\t}\n\t`;\n\n  const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);\n  const fragmentShader = createShader(\n    gl,\n    gl.FRAGMENT_SHADER,\n    fragmentShaderSource\n  );\n\n  const program = createProgram(gl, vertexShader, fragmentShader, [\"outColor\"]);\n  if (program === \"abortSimulation\") {\n    return null;\n  }\n\n  var maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\n\n  var textureWidth = Math.min(\n    3 * N_TRIANGLES,\n    Math.floor(maxTextureSize / 9) * 9\n  );\n  var textureHeight = Math.ceil((3 * N_TRIANGLES) / textureWidth);\n  console.log(\"Max Texture Size\", maxTextureSize, textureWidth, textureHeight);\n\n  const colorBuffer = makeBuffer(gl, N_POINTS * 16);\n  const tf = makeTransformFeedback(gl, colorBuffer);\n  // gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n  // gl.pixelStorei(gl.PACK_ALIGNMENT, 1);\n\n  gl.useProgram(program);\n\n  var texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  var alignedTrianglesArray;\n  if (textureHeight == 1) {\n    alignedTrianglesArray = trianglesArray;\n  } else {\n    alignedTrianglesArray = new Float32Array(textureWidth * textureHeight * 3);\n\n    for (var i = 0; i < N_TRIANGLES; i++) {\n      var x = (3 * i) % textureWidth;\n      var y = Math.floor((3 * i) / textureWidth);\n      var index = y * textureWidth + x;\n      for (var j = 0; j < 3; j++) {\n        alignedTrianglesArray[index + j] = trianglesArray[3 * i + j];\n      }\n    }\n  }\n\n  gl.texImage2D(\n    gl.TEXTURE_2D,\n    0,\n    gl.RGB32F,\n    textureWidth,\n    textureHeight,\n    0,\n    gl.RGB,\n    gl.FLOAT,\n    alignedTrianglesArray\n  );\n\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n  gl.bindTexture(gl.TEXTURE_2D, null);\n\n  var u_trianglesLocation = gl.getUniformLocation(program, \"u_triangles\");\n  gl.activeTexture(gl.TEXTURE0);\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.uniform1i(u_trianglesLocation, 0);\n\n  var u_textureWidth = gl.getUniformLocation(program, \"textureWidth\");\n  gl.uniform1i(u_textureWidth, textureWidth);\n\n  //   const vao = gl.createVertexArray();\n  //   gl.bindVertexArray(vao);\n\n  const positionAttributeLocation = gl.getAttribLocation(program, \"a_position\");\n  const normalAttributeLocation = gl.getAttribLocation(program, \"a_normal\");\n\n  const vao = gl.createVertexArray();\n  gl.bindVertexArray(vao);\n\n  const positionBuffer = makeBufferAndSetAttribute(\n    gl,\n    pointsArray,\n    positionAttributeLocation\n  );\n  const normalBuffer = makeBufferAndSetAttribute(\n    gl,\n    normals,\n    normalAttributeLocation\n  );\n\n  let colorCodedArray;\n  let isShadowedArray;\n  for (var i = 0; i < num_dates; i++) {\n    let sunDirectionUniformLocation = gl.getUniformLocation(\n      program,\n      \"u_sun_direction\"\n    );\n    let sunDirection = retrieveRandomSunDirections(1, loc.lat, loc.lon);\n    gl.uniform3fv(sunDirectionUniformLocation, sunDirection);\n\n    drawArraysWithTransformFeedback(gl, tf, gl.POINTS, N_POINTS);\n\n    if (isShadowedArray == null) {\n      colorCodedArray = getResults(gl, colorBuffer, \"shading\", N_POINTS);\n      isShadowedArray = colorCodedArray.filter(\n        (_, index) => (index + 1) % 4 === 0\n      );\n    } else {\n      colorCodedArray = getResults(gl, colorBuffer, \"shading\", N_POINTS);\n      addToArray(\n        isShadowedArray,\n        colorCodedArray.filter((_, index) => (index + 1) % 4 === 0)\n      );\n    }\n  }\n  return isShadowedArray;\n}\n\nfunction getResults(gl, buffer, label, N_POINTS) {\n  let results = new Float32Array(N_POINTS * 4);\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.getBufferSubData(\n    gl.ARRAY_BUFFER,\n    0, // byte offset into GPU buffer,\n    results\n  );\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, null); // productBuffer was still bound to ARRAY_BUFFER so unbind it\n  return results;\n}\n\nfunction createShader(gl, type, source) {\n  const shader = gl.createShader(type);\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n  const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n  if (success) {\n    return shader;\n  }\n  console.error(gl.getShaderInfoLog(shader));\n  gl.deleteShader(shader);\n}\n\nfunction createProgram(\n  gl,\n  vertexShader,\n  fragmentShader,\n  variables_of_interest\n) {\n  const program = gl.createProgram();\n\n  if (vertexShader === undefined || fragmentShader === undefined) {\n    window.setShowTooManyUniformsError(true);\n    return \"abortSimulation\";\n  } else {\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.transformFeedbackVaryings(\n      program,\n      variables_of_interest,\n      gl.SEPARATE_ATTRIBS\n    );\n    gl.linkProgram(program);\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n    if (success) {\n      return program;\n    }\n    console.error(gl.getProgramInfoLog(program));\n    gl.deleteProgram(program);\n  }\n}\n\nfunction makeBuffer(gl, sizeOrData) {\n  const buf = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, buf);\n  gl.bufferData(gl.ARRAY_BUFFER, sizeOrData, gl.DYNAMIC_DRAW);\n  return buf;\n}\n\nfunction makeTransformFeedback(gl, buffer) {\n  const tf = gl.createTransformFeedback();\n  gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK, tf);\n  gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, 0, buffer);\n  return tf;\n}\n\nfunction makeBufferAndSetAttribute(gl, data, loc) {\n  const buf = makeBuffer(gl, data);\n  // setup our attributes to tell WebGL how to pull\n  // the data from the buffer above to the attribute\n  gl.enableVertexAttribArray(loc);\n  gl.vertexAttribPointer(\n    loc,\n    3, // size (num components)\n    gl.FLOAT, // type of data in buffer\n    false, // normalize\n    0, // stride (0 = auto)\n    0 // offset\n  );\n}\n\nfunction drawArraysWithTransformFeedback(gl, tf, primitiveType, count) {\n  // turn of using the fragment shader\n  gl.enable(gl.RASTERIZER_DISCARD);\n\n  gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK, tf);\n  gl.beginTransformFeedback(gl.POINTS);\n  gl.drawArrays(primitiveType, 0, count);\n  gl.endTransformFeedback();\n  gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK, null);\n\n  // unbind the buffer from the TRANFORM_FEEDBACK_BUFFER\n  gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, 0, null);\n\n  // turn on using fragment shaders again\n  gl.disable(gl.RASTERIZER_DISCARD);\n}\n","import * as THREE from \"three\";\n\nimport { scene, renderer, camera, controls, STLViewer } from \"./stlviewer.js\";\nimport { adaptiveSubdivideMesh } from \"./stl_to_array.js\";\nimport { vec3 } from \"gl-matrix\";\n// import init, { Session, Input} from \"@webonnx/wonnx-wasm\";\n// import { cumulativeIntensityMesh } from './glmatrix_raytracing/glmatrix_raytracing.js';\nimport SunCalc from \"suncalc\";\nimport { loc_utm } from \"./download.js\";\nimport { intensity_colormap } from \"./utils.js\";\nimport { rayTracingWebGL } from \"./webgl_raytracing.js\";\n//import { triangleIntersectText, Calculate_Shading_at_Point_text } from \"./webgl_raytracing.js\";\nimport DatesSlider from \"../components/PVSimulation/DatesSlider.js\";\n\n// import '@tensorflow/tfjs-backend-webgpu';\n// Set the backend to WebGPU and wait for the module to be ready.\n\n// import { STLViewer } from \"./stlviewer_2/stlviewer.js\";\n\nlet raytracingGeometry;\nlet innerGeometry;\nlet outerGeometry;\nvar intensities = null;\n\nexport function getViewer() {\n  return [scene, renderer, camera, controls];\n}\n\nexport function retrieveRandomSunDirections(Ndates, lat, lon) {\n  const directions = new Float32Array(Ndates * 3);\n  var i = 0;\n  while (i < Ndates) {\n    const date = new Date(\n      2023,\n      Math.floor(12 * Math.random()),\n      1 + Math.floor(28 * Math.random()),\n      Math.floor(24 * Math.random()),\n      Math.floor(60 * Math.random()),\n      0,\n      0\n    );\n\n    const pos = SunCalc.getPosition(date, lat, lon);\n    if (pos.altitude < 0.1 || pos.altitude == Number.NaN) {\n      continue;\n    }\n    directions[3 * i] = -Math.cos(pos.altitude) * Math.sin(pos.azimuth);\n    directions[3 * i + 1] = -Math.cos(pos.altitude) * Math.cos(pos.azimuth);\n    directions[3 * i + 2] = Math.sin(pos.altitude);\n    i += 1;\n  }\n  return directions;\n}\n\nexport async function calc_webgl(loc, resetCamera) {\n  const mesh_vectors = raytracingGeometry.attributes.position.array;\n  const points = innerGeometry.attributes.position.array;\n  const normals = innerGeometry.attributes.normal.array;\n\n  const status_elem = document.getElementById(\"status\");\n  status_elem.textContent = \"Simulating\";\n  status_elem.hasChanged = true;\n\n  let uniquePoints = [];\n  let uniqueNormals = [];\n\n  // Create an object to hold point/normal pairs, where the key is a string representation of the point\n  const uniquePairs = {};\n\n  for (let i = 0; i < points.length; i += 3) {\n    const point = [points[i], points[i + 1], points[i + 2]].map((value) =>\n      parseFloat(value.toFixed(6))\n    ); // limit precision\n    const pointKey = JSON.stringify(point);\n\n    if (!uniquePairs.hasOwnProperty(pointKey)) {\n      uniquePairs[pointKey] = i / 3;\n      uniquePoints.push(points[i], points[i + 1], points[i + 2]);\n      uniqueNormals.push(normals[i], normals[i + 1], normals[i + 2]);\n    }\n  }\n\n  const uniquePointsArray = new Float32Array(uniquePoints.slice());\n  const uniqueNormalsArray = new Float32Array(uniqueNormals.slice());\n\n  // Compute unique intensities\n  const uniqueIntensities = await rayTracingWebGL(\n    uniquePointsArray,\n    mesh_vectors,\n    uniqueNormalsArray,\n    window.numSimulations,\n    loc\n  );\n  if (uniqueIntensities === null) {\n    window.setLoading(false);\n    return null;\n  }\n  // Store unique intensities in uniquePairs\n  for (let i = 0; i < uniqueIntensities.length; i++) {\n    const point = [\n      uniquePoints[i * 3],\n      uniquePoints[i * 3 + 1],\n      uniquePoints[i * 3 + 2],\n    ].map((value) => parseFloat(value.toFixed(6))); // limit precision\n    const pointKey = JSON.stringify(point);\n\n    if (uniquePairs.hasOwnProperty(pointKey)) {\n      uniquePairs[pointKey] = uniqueIntensities[i];\n    } else {\n      console.error(`Couldn't find indices for pointKey ${pointKey}`);\n    }\n  }\n\n  // Generate final intensities array\n  let intensities_array = new Array(points.length / 3).fill(0);\n\n  for (let i = 0; i < points.length; i += 3) {\n    const point = [points[i], points[i + 1], points[i + 2]].map((value) =>\n      parseFloat(value.toFixed(6))\n    ); // limit precision\n    const pointKey = JSON.stringify(point);\n\n    if (uniquePairs.hasOwnProperty(pointKey)) {\n      intensities_array[i / 3] = uniquePairs[pointKey];\n    }\n  }\n\n  const intensities = new Float32Array(intensities_array);\n\n  status_elem.textContent = \"Simulation Done\";\n  status_elem.hasChanged = true;\n  window.setLoading(false);\n  showMeshIntensities(intensities, resetCamera);\n}\n\nfunction refine_triangles(triangle_array, threshold) {\n  const triangles = [\n    [\n      vec3.fromValues(...triangle_array.slice(0, 3)),\n      vec3.fromValues(...triangle_array.slice(3, 6)),\n      vec3.fromValues(...triangle_array.slice(6, 9)),\n    ],\n  ];\n\n  const subdividedTriangles = adaptiveSubdivideMesh(triangles, threshold);\n\n  const newpos_update = [];\n  for (const triangle of subdividedTriangles) {\n    newpos_update.push(...triangle);\n  }\n  return newpos_update;\n}\n\nfunction centerMesh(geometry, xytranslate) {\n  // centralize mesh to main point\n  var minZ = Number.POSITIVE_INFINITY;\n\n  // Iterate over vertices and find the minimum z value\n  for (var i = 0; i < geometry.attributes.position.array.length; i++) {\n    const zcoord = geometry.attributes.position.getZ(i);\n    if (zcoord < minZ) {\n      minZ = zcoord;\n    }\n  }\n\n  var posarray = geometry.attributes.position.array;\n  for (var i = 0; i < posarray.length; i += 9) {\n    for (var j = 0; j < 9; j += 3) {\n      posarray[i + j] = posarray[i + j] - xytranslate[0];\n      posarray[i + j + 1] = posarray[i + j + 1] - xytranslate[1];\n      posarray[i + j + 2] = posarray[i + j + 2] - minZ;\n    }\n  }\n}\n\nfunction cutoffMesh(geometry, cutoff) {\n  var posarray = geometry.attributes.position.array.slice();\n  var newposarray = [];\n  var newnormals = [];\n  for (var i = 0; i < posarray.length; i += 9) {\n    var keep = true;\n    for (var j = 0; j < 9; j += 3) {\n      if (\n        posarray[i + j] < -cutoff ||\n        posarray[i + j] > cutoff ||\n        posarray[i + j + 1] < -cutoff ||\n        posarray[i + j + 1] > cutoff\n      ) {\n        keep = false;\n      }\n    }\n\n    if (keep) {\n      const v0 = vec3.fromValues(...posarray.slice(i, i + 3));\n      const v1 = vec3.fromValues(...posarray.slice(i + 3, i + 6));\n      const v2 = vec3.fromValues(...posarray.slice(i + 6, i + 9));\n      let d1 = vec3.create();\n      vec3.sub(d1, v1, v0);\n      let d2 = vec3.create();\n      vec3.sub(d2, v2, v0);\n      let ar = vec3.create();\n      vec3.cross(ar, d1, d2);\n      var normal = vec3.create();\n      vec3.scale(normal, ar, 1 / vec3.len(ar));\n\n      //remove triangles with low area for shading\n      if (vec3.len(ar) < 0.05) {\n        continue;\n      }\n\n      for (var j = 0; j < 9; j++) {\n        newposarray.push(posarray[i + j]);\n        newnormals.push(normal[j % 3]);\n      }\n    }\n  }\n\n  let new_geometry = new THREE.BufferGeometry();\n  new_geometry.setAttribute(\n    \"position\",\n    new THREE.BufferAttribute(new Float32Array(newposarray), 3)\n  );\n  new_geometry.setAttribute(\n    \"normal\",\n    new THREE.BufferAttribute(new Float32Array(newnormals), 3)\n  );\n  new_geometry.attributes.position.needsUpdate = true;\n  new_geometry.attributes.normal.needsUpdate = true;\n  return new_geometry;\n}\n\nfunction splitCutoffRefineMesh(\n  geometry,\n  refinementCutoff,\n  outerCutoff,\n  adaptiveSubdivideThreshold = Number.POSITIVE_INFINITY\n) {\n  let geometriesCut = cutoffMesh(geometry, outerCutoff);\n  var posarray = geometriesCut.attributes.position.array.slice();\n\n  var innerPosarray = [];\n  var innerNormals = [];\n\n  var outerPosarray = [];\n  var outerNormals = [];\n\n  for (var i = 0; i < posarray.length; i += 9) {\n    var isInnerGeometry = true;\n    for (var j = 0; j < 9; j += 3) {\n      if (\n        posarray[i + j] < -refinementCutoff ||\n        posarray[i + j] > refinementCutoff ||\n        posarray[i + j + 1] < -refinementCutoff ||\n        posarray[i + j + 1] > refinementCutoff\n      ) {\n        isInnerGeometry = false;\n        // break;\n      }\n    }\n\n    const v0 = vec3.fromValues(...posarray.slice(i, i + 3));\n    const v1 = vec3.fromValues(...posarray.slice(i + 3, i + 6));\n    const v2 = vec3.fromValues(...posarray.slice(i + 6, i + 9));\n    let d1 = vec3.create();\n    vec3.sub(d1, v1, v0);\n    let d2 = vec3.create();\n    vec3.sub(d2, v2, v0);\n    let ar = vec3.create();\n    vec3.cross(ar, d1, d2);\n    var normal = vec3.create();\n    vec3.scale(normal, ar, 1 / vec3.len(ar));\n\n    if (vec3.len(ar) < 0.05) {\n      continue;\n    }\n    if (isInnerGeometry) {\n      var triangle_points = refine_triangles(\n        posarray.slice(i, i + 9),\n        adaptiveSubdivideThreshold\n      );\n\n      for (const triangle of triangle_points) {\n        innerPosarray.push(triangle[0]);\n        innerPosarray.push(triangle[1]);\n        innerPosarray.push(triangle[2]);\n        innerNormals.push(normal[0]);\n        innerNormals.push(normal[1]);\n        innerNormals.push(normal[2]);\n      }\n    } else {\n      for (var j = 0; j < 9; j++) {\n        outerPosarray.push(posarray[i + j]);\n        outerNormals.push(normal[j % 3]);\n      }\n    }\n  }\n\n  let innerGeometry = new THREE.BufferGeometry();\n  innerGeometry.setAttribute(\n    \"position\",\n    new THREE.BufferAttribute(new Float32Array(innerPosarray), 3)\n  );\n  innerGeometry.setAttribute(\n    \"normal\",\n    new THREE.BufferAttribute(new Float32Array(innerNormals), 3)\n  );\n  innerGeometry.attributes.position.needsUpdate = true;\n  innerGeometry.attributes.normal.needsUpdate = true;\n\n  let outerGeometry = new THREE.BufferGeometry();\n  outerGeometry.setAttribute(\n    \"position\",\n    new THREE.BufferAttribute(new Float32Array(outerPosarray), 3)\n  );\n  outerGeometry.setAttribute(\n    \"normal\",\n    new THREE.BufferAttribute(new Float32Array(outerNormals), 3)\n  );\n  outerGeometry.attributes.position.needsUpdate = true;\n  outerGeometry.attributes.normal.needsUpdate = true;\n\n  return { innerGeometry: innerGeometry, outerGeometry: outerGeometry };\n}\n\nexport function createMeshes(\n  big_geometry,\n  offset,\n  cutoffRaytracing = window.numRadiusSimulation + 20,\n  outerCutoff = window.numRadiusSimulation + 70,\n  refinementCutoff = window.numRadiusSimulation,\n  mesh_refinement_scale = 2\n) {\n  intensities = null;\n  //center the big mesh around the building coordinates from OSM\n  centerMesh(big_geometry, [loc_utm[0] - offset[0], loc_utm[1] - offset[1]]);\n\n  raytracingGeometry = cutoffMesh(big_geometry, cutoffRaytracing);\n\n  let geometryDict = splitCutoffRefineMesh(\n    big_geometry,\n    refinementCutoff,\n    outerCutoff,\n    mesh_refinement_scale\n  );\n  innerGeometry = geometryDict.innerGeometry;\n  outerGeometry = geometryDict.outerGeometry;\n\n  if (innerGeometry.attributes.position.array.length === 0) {\n    window.setLoading(false);\n    window.setShowErrorMessage(true);\n    window.setShowThreeViewer(false);\n  }\n}\n\nexport function showMeshOrig() {\n  var elem = document.getElementsByClassName(\"stlviewer\")[0];\n  const newelem = document.createElement(\"div\");\n  newelem.setAttribute(\"class\", \"stlviewer\");\n  elem.replaceWith(newelem);\n  newelem.id = \"webgl-container\";\n  STLViewer(newelem);\n\n  const Npoints = innerGeometry.attributes.position.array.length / 3;\n  var newColors = new Float32Array(3 * Npoints);\n  for (var i = 0; i < Npoints; i++) {\n    newColors[3 * i] = 0.6 + 0.4 * Math.random();\n    newColors[3 * i + 1] = 0.4 + 0.3 * Math.random();\n    newColors[3 * i + 2] = 0.3 * Math.random();\n  }\n\n  innerGeometry.setAttribute(\"color\", new THREE.BufferAttribute(newColors, 3));\n  var material = new THREE.MeshStandardMaterial({ vertexColors: true });\n  // var material = new THREE.MeshStandardMaterial({ color: 0xd1bea4 });\n  var mesh = new THREE.Mesh(innerGeometry, material);\n  scene.add(mesh);\n\n  // Compute the middle\n  var middle = new THREE.Vector3();\n  innerGeometry.computeBoundingBox();\n  innerGeometry.boundingBox.getCenter(middle);\n\n  // Center it\n  //mesh.position.x = -1 * middle.x;\n  //mesh.position.y = -1 * middle.y;\n  //mesh.position.z = -1 * middle.z+3;\n\n  // Pull the camera away as needed\n  var largestDimension = Math.max(\n    innerGeometry.boundingBox.max.x,\n    innerGeometry.boundingBox.max.y,\n    innerGeometry.boundingBox.max.z\n  );\n  camera.position.set(0, -20, 100);\n  camera.position.z = 40;\n\n  var animate = function () {\n    requestAnimationFrame(animate);\n    controls.update();\n    renderer.render(scene, camera);\n  };\n  animate();\n}\n\nexport async function replot() {\n  showMeshIntensities();\n}\n\nexport async function showMeshIntensities(intensities, resetCamera) {\n  var oldCameraPosition;\n  if (resetCamera || camera == null) {\n    oldCameraPosition = { x: 0, y: 0, z: 0 };\n  } else {\n    oldCameraPosition = {\n      x: camera.position.x,\n      y: camera.position.y,\n      z: camera.position.z,\n    };\n  }\n\n  STLViewer(resetCamera);\n\n  const Npoints = innerGeometry.attributes.position.array.length / 3;\n  var newColors = new Float32Array(Npoints * 3);\n  //var intMax = get99thPercentile(intensities);\n  for (var i = 0; i < Npoints; i++) {\n    const col = intensity_colormap(\n      Math.min(1, intensities[i] / window.numSimulations / 0.6)\n    );\n    //The 0.6 comes from looking at a rooftop facing south with good angle.\n    newColors[3 * i] = col[0];\n    newColors[3 * i + 1] = col[1];\n    newColors[3 * i + 2] = col[2];\n  }\n\n  innerGeometry.setAttribute(\n    \"color\",\n    new THREE.Float32BufferAttribute(newColors, 3)\n  );\n  var material = new THREE.MeshStandardMaterial({\n    vertexColors: true,\n    side: THREE.DoubleSide,\n    shininess: 0,\n    roughness: 1,\n  });\n  // var material = new THREE.MeshStandardMaterial({ color: 0xd1bea4 });\n  var mesh = new THREE.Mesh(innerGeometry, material);\n\n  scene.add(mesh);\n\n  var outerGeometryMaterial = new THREE.MeshStandardMaterial({\n    vertexColors: false,\n    side: THREE.DoubleSide,\n    color: 0xd1bea4,\n    shininess: 0,\n    roughness: 1,\n  });\n  // var material = new THREE.MeshStandardMaterial({ color: 0xd1bea4 });\n  var outerMesh = new THREE.Mesh(outerGeometry, outerGeometryMaterial);\n\n  scene.add(outerMesh);\n\n  // Compute the middle\n  var middle = new THREE.Vector3();\n  innerGeometry.computeBoundingBox();\n  innerGeometry.boundingBox.getCenter(middle);\n\n  // Pull the camera away as needed\n  var largestDimension = Math.max(\n    innerGeometry.boundingBox.max.x,\n    innerGeometry.boundingBox.max.y,\n    innerGeometry.boundingBox.max.z\n  );\n\n  if (resetCamera) {\n    camera.position.set(0, -40, 80);\n  } else {\n    // console.log(\"Camera Rot\", camera.rotation);\n\n    camera.position.set(\n      oldCameraPosition.x - window.offsetPos[0],\n      oldCameraPosition.y - window.offsetPos[1],\n      oldCameraPosition.z\n    );\n    // console.log(\"New Camera Pos\", camera.position);\n  }\n\n  var animate = function () {\n    requestAnimationFrame(animate);\n    controls.update();\n    renderer.render(scene, camera);\n  };\n  window.setShowViridisLegend(true);\n  animate();\n}\n","import { calc_webgl, createMeshes } from \"./pv_simulation\";\nimport JSZip from \"jszip\";\nimport proj4 from \"proj4\";\nimport { STLLoader } from \"three/examples/jsm/loaders/STLLoader.js\";\nimport * as BufferGeometryUtils from \"three/addons/utils/BufferGeometryUtils.js\";\nexport var loc_utm;\n\n// var state = \"WaitForAddr\"; // States are \"WaitForAddr\", \"AddrDataLoaded\", \"Inspect\"\n\nasync function getLocationFromInput(locationText) {\n  let loc;\n  const coordinatePattern = /^[-]?(\\d+(\\.\\d+)?),\\s*[-]?(\\d+(\\.\\d+)?)$/;\n\n  // Check if the string matches the coordinate pattern\n  if (coordinatePattern.test(locationText)) {\n    const [latitude, longitude] = locationText\n      .split(\",\")\n      .map((value) => parseFloat(value.trim()));\n\n    // Create the \"loc\" object with latitude and longitude attributes\n    loc = {\n      lat: latitude,\n      lon: longitude,\n    };\n    return loc;\n  } else {\n    let url = \"https://nominatim.openstreetmap.org/search?format=json&q=\"\n      .concat(locationText)\n      .concat(\"+Germany+Bavaria\");\n    let response = await fetchLocation(url);\n    if (!response) {\n      let locationTextModified = locationText.split(\" \").join(\"+\");\n      url = \"https://nominatim.openstreetmap.org/search?format=json&q=\".concat(\n        locationTextModified\n      );\n      response = await fetchLocation(url);\n    }\n    return response;\n  }\n}\n\nasync function fetchLocation(url) {\n  let loc;\n  const statuselem = document.getElementById(\"status\");\n  try {\n    let response = await fetch(url);\n    if (!response.ok) {\n      console.error(\"Check connection to Nominatim geocoder\");\n      statuselem.textContent = \"Connection to Adress Server failed\";\n      throw new Error(\"Request failed with status \" + response.status);\n    }\n\n    let responseData = await response.json();\n    if (responseData.length === 0) {\n      return null;\n    }\n\n    loc = responseData[0];\n    return loc;\n  } catch (error) {\n    console.error(\"Error:\", error);\n    return null;\n  }\n}\n\nexport async function setLocation(\n  inputValue,\n  inputChanged,\n  simulationParamChanged,\n  loc\n) {\n  let newloc;\n  window.mapLocationBaseChanged = true;\n  if (inputChanged) {\n    newloc = await getLocationFromInput(inputValue);\n    window.mapLocation = newloc;\n  } else if (simulationParamChanged || window.mapLocationChanged) {\n    newloc = loc;\n  } else {\n    window.setLoading(false);\n  }\n  // console.log(newloc);\n  if (typeof newloc !== \"undefined\" && newloc != null) {\n    retrieveData(newloc, inputChanged);\n  } else {\n    window.setLoading(false);\n    window.setShowThreeViewer(false);\n    window.setShowErrorMessage(true);\n  }\n\n  if (inputChanged) {\n    window.mapLocationChanged = false;\n  }\n}\n\nfunction get_file_names(x, y) {\n  const DIVISOR = 2000;\n  const BUFFER_ZONE = 100;\n  const IN_PROJ = \"EPSG:4326\";\n  const OUT_PROJ = \"EPSG:25832\";\n\n  proj4.defs(\"EPSG:25832\", \"+proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs\");\n\n  const transformer = proj4(IN_PROJ, OUT_PROJ);\n\n  const [x_utm32, y_utm32] = transformer.forward([x, y]);\n  loc_utm = [x_utm32, y_utm32];\n\n  const x_rounded = Math.floor(x_utm32 / DIVISOR) * 2;\n  const y_rounded = Math.floor(y_utm32 / DIVISOR) * 2;\n\n  const load_tile_left = x_utm32 % DIVISOR < BUFFER_ZONE;\n  const load_tile_right = x_utm32 % DIVISOR > DIVISOR - BUFFER_ZONE;\n  const load_tile_lower = y_utm32 % DIVISOR < BUFFER_ZONE;\n  const load_tile_upper = y_utm32 % DIVISOR > DIVISOR - BUFFER_ZONE;\n\n  const file_list = [`${x_rounded}_${y_rounded}.zip`];\n\n  if (load_tile_left) {\n    file_list.push(`${x_rounded - 2}_${y_rounded}.zip`);\n  }\n  if (load_tile_right) {\n    file_list.push(`${x_rounded + 2}_${y_rounded}.zip`);\n  }\n  if (load_tile_lower) {\n    file_list.push(`${x_rounded}_${y_rounded - 2}.zip`);\n  }\n  if (load_tile_upper) {\n    file_list.push(`${x_rounded}_${y_rounded + 2}.zip`);\n  }\n  if (load_tile_left && load_tile_lower) {\n    file_list.push(`${x_rounded - 2}_${y_rounded - 2}.zip`);\n  }\n  if (load_tile_left && load_tile_upper) {\n    file_list.push(`${x_rounded - 2}_${y_rounded + 2}.zip`);\n  }\n  if (load_tile_right && load_tile_lower) {\n    file_list.push(`${x_rounded + 2}_${y_rounded - 2}.zip`);\n  }\n  if (load_tile_right && load_tile_upper) {\n    file_list.push(`${x_rounded + 2}_${y_rounded + 2}.zip`);\n  }\n  return file_list;\n}\n\nfunction getCommentLine(stlData) {\n  // Convert the ArrayBuffer to a Uint8Array\n  var uint8Array = new Uint8Array(stlData);\n\n  // Create an empty array to store the characters\n  var commentChars = [];\n\n  // Iterate over the Uint8Array in reverse order\n  for (var i = uint8Array.length - 2; i >= 0; i--) {\n    // Check if the current character is a newline character\n    if (uint8Array[i] === 10 || uint8Array[i] === 13) {\n      // Stop iterating if a newline character is encountered\n      break;\n    }\n\n    // Add the current character to the commentChars array\n    commentChars.unshift(String.fromCharCode(uint8Array[i]));\n  }\n\n  // Convert the array of characters to a string\n  var commentLine = commentChars.join(\"\");\n\n  // Remove any leading or trailing whitespace\n  commentLine = commentLine.trim();\n  return commentLine;\n}\n\nfunction parseCommentLine(comment) {\n  // Regular expression pattern to match the comment line format\n  var pattern =\n    /^;\\s*offset\\s*(-?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)\\s*(-?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)\\s*(-?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)\\s*$/i;\n\n  // Match the comment line against the pattern\n  var match = comment.match(pattern);\n\n  var offset = [0, 0, 0];\n  // Check if the comment line matches the expected format\n  if (match) {\n    // Extract the offsets from the matched groups\n    console.log(\"Matches\", match);\n    offset = [parseFloat(match[1]), parseFloat(match[2]), parseFloat(match[3])];\n\n    // Print the offsets\n    console.log(\"Offsets:\", offset[0], offset[1], offset[2]);\n  } else {\n    console.log(\"Invalid comment format\");\n  }\n  return offset;\n}\n\nasync function retrieveData(loc, resetCamera = false) {\n  const baseurl = \"https://www.openpv.de/data/\";\n  var filenames = get_file_names(Number(loc.lon), Number(loc.lat));\n  if (filenames.length == 0) {\n    return;\n  }\n\n  const status_elem = document.getElementById(\"status\");\n\n  // Create an array to store individual geometries\n  let geometries = [];\n  let zipData = null;\n  var cached_file_found = false;\n  var main_offset = null;\n  // Iterate through all filenames\n  for (const filename of filenames) {\n    let filename_idx;\n    if (window.stlFile != null) {\n      filename_idx = window.stlFiles.indexOf(filename);\n    } else {\n      filename_idx = -1;\n    }\n    if (filename_idx != -1) {\n      zipData = window.stlDataCached[filename_idx];\n      cached_file_found = true;\n      console.log(\"Use cached file!!\");\n    } else {\n      let url = baseurl + filename;\n      status_elem.textContent = \"Loading from \" + url;\n\n      try {\n        // Download the zipped STL file\n        let response;\n        response = await fetch(url);\n        if (!response.ok) {\n          throw new Error(\"Request failed with status \" + response.status);\n        }\n        zipData = await response.arrayBuffer();\n        if (!cached_file_found) {\n          window.stlDataCached = [zipData];\n          window.stlFiles = [filename];\n        } else {\n          window.stlDataCached.append(zipData);\n          window.stlFiles.append(filename);\n        }\n      } catch (error) {\n        window.setLoading(false);\n        window.setShowErrorMessage(true);\n        return;\n      }\n    }\n\n    // Unzip the zipped STL file\n    const zip = new JSZip();\n    await zip.loadAsync(zipData);\n\n    // Get the STL file from the unzipped contents\n    const stlFile = zip.file(Object.keys(zip.files)[0]);\n    if (stlFile) {\n      // Load the STL file\n      const stlData = await stlFile.async(\"arraybuffer\");\n      stlDataCached = stlData;\n\n      // Parse the STL data and add the geometry to the geometries array\n      let geometry = new STLLoader().parse(stlData);\n\n      // Create and display the combined mesh\n      const comment = getCommentLine(stlData);\n      var local_offset = parseCommentLine(comment);\n\n      if (main_offset == null) {\n        main_offset = local_offset;\n        local_offset = [0, 0, 0];\n      } else {\n        local_offset = [\n          local_offset[0] - main_offset[0],\n          local_offset[1] - main_offset[1],\n          local_offset[2] - main_offset[2],\n        ];\n        geometry.translate(local_offset[0], local_offset[1], local_offset[2]);\n      }\n\n      geometries.push(geometry);\n      // Merge geometries using BufferGeometryUtils\n      const combinedGeometry = BufferGeometryUtils.mergeGeometries(geometries);\n\n      // console.log(\"Comments:\", comment);\n\n      createMeshes(combinedGeometry, main_offset);\n      //showMeshOrig();\n      calc_webgl(loc, resetCamera);\n    } else {\n      console.error(\"STL file not found in ZIP archive\");\n    }\n  }\n}\n","import React from 'react';\n\nfunction WrongAdress () {\n        return (\n            <div style={{alignItems: 'center'}}>\n              <p>\n                Adresse wurde nicht gefunden oder liegt nicht innerhalb von Bayern. Leider können wir aktuell nur Häuser in Bayern simulieren. \n              </p>\n              <p>\n                Alternativ kannst du auch die Koordinaten in Google Maps per Rechtsklick bestimmen und in das Suchfeld eingeben.\n              </p>\n              <img src=\"images/googleMaps.gif\" alt=\"Showing how to get coordinates from Google Maps\" style={{ width: '100%', maxWidth: '500px' }} />\n            </div>\n          );\n    }\n\nexport default WrongAdress;\n","import React from 'react';\n\nfunction TooManyUniforms () {\n        return (\n            <div style={{alignItems: 'center'}}>\n              <p>\n                Leider ist das ausgewählte Gebiet zu groß, um auf deinem PC simuliert zu werden. Du kannst den Gebäuderadius mit dem Slider\n                auf der linken Seite kleiner stellen, um dieses Problem zu beheben.\n              </p>\n            </div>\n          );\n    }\n\nexport default TooManyUniforms;\n","import React, { useState } from \"react\";\nimport { setLocation } from \"../../simulation/download\";\nimport DotLoader from \"react-spinners/DotLoader\";\nimport WrongAdress from \"../ErrorMessages/WrongAdress\";\nimport TooManyUniforms from \"../ErrorMessages/TooManyUniforms\";\n\nconst override = {\n  display: \"block\",\n  margin: \"auto\",\n  borderColor: \"red\",\n};\n\nfunction SearchField() {\n  const [inputValue, setInputValue] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [showErrorMessage, setShowErrorMessage] = useState(false);\n  const [inputChanged, setInputChanged] = useState(false);\n  const [showTooManyUniformsError, setShowTooManyUniformsError] =\n    useState(false);\n  window.setShowErrorMessage = setShowErrorMessage;\n  window.setShowTooManyUniformsError = setShowTooManyUniformsError;\n  window.setLoading = setLoading;\n  const handleSubmit = (event) => {\n    if (\n      inputChanged ||\n      window.numRadiusSimulationChanged ||\n      window.numSimulationsChanged ||\n      window.mapLocationChanged\n    ) {\n      setLoading(!loading);\n      window.setShowViridisLegend(false);\n      event.preventDefault();\n      window.setShowThreeViewer(true);\n      setLocation(\n        inputValue,\n        inputChanged,\n        window.numRadiusSimulationChanged || window.numSimulationsChanged,\n        window.mapLocation\n      );\n      window.numRadiusSimulationChanged = false;\n      window.numSimulationsChanged = false;\n      window.mapLocationChanged = false;\n      setShowErrorMessage(false);\n      setShowTooManyUniformsError(false);\n      setInputChanged(false);\n    } else {\n      event.preventDefault();\n    }\n  };\n  const handleChange = (event) => {\n    if (inputValue != event.target.value) {\n      setInputValue(event.target.value);\n      setInputChanged(true);\n    }\n  };\n  return (\n    <>\n      <form\n        onSubmit={handleSubmit}\n        style={{ display: \"flex\", alignItems: \"center\" }}\n      >\n        <input\n          type=\"text\"\n          placeholder=\"Geben Sie Ihre Addresse oder Koordinaten ein\"\n          value={inputValue}\n          onChange={handleChange}\n        />\n        <button type=\"submit\">Start</button>\n      </form>\n      {showErrorMessage && <WrongAdress />}\n      {showTooManyUniformsError && <TooManyUniforms />}\n      <DotLoader\n        color=\"MediumAquaMarine\"\n        cssOverride={override}\n        loading={loading}\n        size={60}\n      />\n    </>\n  );\n}\n\nexport default SearchField;\n","import { Canvas } from \"react-three-fiber\";\nimport { camera, scene, controls, renderer } from \"../../simulation/stlviewer\";\nimport { useState } from \"react\";\nimport { setLocation } from \"../../simulation/download\";\nimport * as THREE from \"three\";\n\nexport default function ThreeViewer() {\n  const [offsetPosition, setOffsetPosition] = useState([0, 0]); // initial camera position\n  const [loading, setLoading] = useState(false);\n  window.offsetPos = [0, 0];\n\n  const addLocationCylinder = (newPos) => {\n    const cylinderHeight = 100;\n    const geometry = new THREE.CylinderGeometry(0.25, 0.25, cylinderHeight, 32);\n    const material = new THREE.MeshBasicMaterial({ color: 0x888888 });\n    const cylinder = new THREE.Mesh(geometry, material);\n    cylinder.position.set(newPos[0], newPos[1], cylinderHeight / 2);\n    cylinder.rotation.set(Math.PI / 2, 0, 0);\n    scene.add(cylinder);\n\n    // setTimeout(() => {\n    //   scene.remove(cylinder);\n    //   cylinder.geometry.dispose();\n    //   cylinder.material.dispose();\n    //   renderer.render(scene, camera);\n    // }, 2000);\n\n    // Create a function to gradually reduce the opacity\n    function fade() {\n      if (cylinder.scale.y > 0.1) {\n        // Reduce the scale by a small amount\n        cylinder.scale.y *= 0.95;\n        cylinder.position.z = (cylinder.scale.y * cylinderHeight) / 2;\n        // Increase the color brightness by a small amount\n        material.color.lerp(new THREE.Color(0xbbbbbb), 0.04); // Bright green\n\n        // renderer.render(scene, camera);\n        // Call this function again after a small delay\n        setTimeout(fade, 20);\n      } else {\n        // Once the opacity reaches 0, remove the cylinder from the scene\n        scene.remove(cylinder);\n\n        // Dispose of the geometry and the material\n        cylinder.geometry.dispose();\n        cylinder.material.dispose();\n      }\n    }\n\n    // Start the fading process\n    fade();\n  };\n\n  const movePosition = (x, y) => {\n    var offset = [0, 0];\n    // console.log(\"MapBaseChanged: \", window.mapLocationBaseChanged);\n    // console.log(\"MapChanged: \", window.mapLocationChanged);\n    if (window.mapLocationBaseChanged) {\n      setOffsetPosition(0, 0);\n      offset = [-offsetPosition[0], -offsetPosition[1]];\n      window.mapLocationBaseChanged = false;\n    } else {\n      offset = [0, 0];\n    }\n\n    if (window.mapLocation != null) {\n      const distanceStep = window.distanceStep;\n\n      const direction = Math.atan2(camera.rotation.y, camera.rotation.x);\n      const step = {\n        x:\n          x * distanceStep * Math.cos(direction) -\n          y * distanceStep * Math.sin(direction),\n        y:\n          y * distanceStep * Math.cos(direction) +\n          x * distanceStep * Math.sin(direction),\n      };\n      const newPos = [\n        offsetPosition[0] + step.x + offset[0],\n        offsetPosition[1] + step.y + offset[1],\n      ];\n      window.offsetPos = newPos;\n      setOffsetPosition([newPos[0], newPos[1]]);\n      const loc = { lon: window.mapLocation.lon, lat: window.mapLocation.lat };\n      var newloc = { lon: parseFloat(loc.lon), lat: parseFloat(loc.lat) };\n      // console.log(direction, step, offset);\n      // console.log(newPos);\n      // console.log(\"Old location: \", newloc.lon, newloc.lat);\n      newloc.lon +=\n        (step.x * 360) / 40000000 / Math.cos((newloc.lat / 180) * Math.PI);\n      newloc.lat += (step.y * 360) / 40000000;\n      // console.log(\"Update location: \", loc, newloc);\n      newloc = { lat: newloc.lat.toString(), lon: newloc.lon.toString() };\n      window.mapLocation = newloc;\n      window.mapLocationChanged = true;\n\n      camera.position.set(\n        camera.position.x + step.x,\n        camera.position.y + step.y,\n        camera.position.z\n      );\n      camera.lookAt(newPos[0], newPos[1], 0);\n      controls.target.set(newPos[0], newPos[1], 0);\n\n      // console.log(\"PostMove Camera Position\", camera.position);\n      // console.log(\"Camera Rot\", camera.rotation);\n\n      var animate = function () {\n        requestAnimationFrame(animate);\n        controls.update();\n        renderer.render(scene, camera);\n      };\n      animate();\n\n      addLocationCylinder(newPos);\n    }\n  };\n\n  const resimulate = () => {\n    setLoading(!loading);\n    if (\n      window.numRadiusSimulationChanged ||\n      window.numSimulationsChanged ||\n      window.mapLocationChanged\n    ) {\n      window.setShowViridisLegend(false);\n      window.setShowThreeViewer(true);\n      setLocation(\n        \"\",\n        false,\n        window.numRadiusSimulationChanged || window.numSimulationsChanged,\n        window.mapLocation\n      );\n      window.numRadiusSimulationChanged = false;\n      window.numSimulationsChanged = false;\n      window.mapLocationChanged = false;\n    }\n  };\n\n  return (\n    <div className=\"viewer-container\" style={{ position: \"relative\" }}>\n      <Canvas className=\"three-viewer\" flat linear></Canvas>\n      <canvas id=\"canvas\" width={0} height={0}></canvas>\n      {window.showViridisLegend && <>\n        <button\n          className=\"arrowButton\"\n          onClick={() => movePosition(0, 1)}\n          style={{ right: \"1em\", bottom: \"2em\" }}\n        >\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n            <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"5\"></line>\n            <polyline points=\"5 12 12 5 19 12\"></polyline>\n          </svg>\n        </button>\n        <button\n          className=\"arrowButton\"\n          onClick={() => movePosition(0, -1)}\n          style={{ right: \"1em\", bottom: \"0em\" }}\n        >\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 24 24\"\n            style={{ transform: \"rotate(180deg)\" }}\n          >\n            <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"5\"></line>\n            <polyline points=\"5 12 12 5 19 12\"></polyline>\n          </svg>\n        </button>\n        <button\n          className=\"arrowButton\"\n          onClick={resimulate}\n          style={{ right: \"1em\", bottom: \"1em\" }}\n        >\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            width=\"50\"\n            height=\"50\"\n            viewBox=\"0 0 50 50\"\n          >\n            <polyline\n              points=\"10,25 20,35 40,15\"\n              stroke=\"#000000\"\n              strokeWidth=\"0.5em\"\n              fill=\"none\"\n            />\n          </svg>\n        </button>\n        <button\n          className=\"arrowButton\"\n          onClick={() => movePosition(-1, 0)}\n          style={{ right: \"2em\", bottom: \"1em\" }}\n        >\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 24 24\"\n            style={{ transform: \"rotate(270deg)\" }}\n          >\n            <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"5\"></line>\n            <polyline points=\"5 12 12 5 19 12\"></polyline>\n          </svg>\n        </button>\n        <button\n          className=\"arrowButton\"\n          onClick={() => movePosition(1, 0)}\n          style={{ right: \"0em\", bottom: \"1em\" }}\n        >\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 24 24\"\n            style={{ transform: \"rotate(90deg)\" }}\n          >\n            <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"5\"></line>\n            <polyline points=\"5 12 12 5 19 12\"></polyline>\n          </svg>\n        </button>\n      </>\n      }\n    </div>\n  );\n}\n","import React from \"react\";\n\n\nconst ViridisLegend = () => {\n    return (\n        <img\n            src=\"images/viridis_legend.svg\"\n            alt=\"Legend of the viridis colormap\"\n            style={{ opacity: 0.6 }}\n            width=\"100%\"\n        />\n    );\n}\n\n\nexport default ViridisLegend;","import React, { useState } from 'react';\nimport SearchField from '../components/PVSimulation/SearchField';\n\nimport Main from '../layouts/Main';\nimport ThreeViewer from '../components/ThreeViewer/ThreeViewer';\nimport ViridisLegend from '../components/ThreeViewer/ViridisLegend';\n\nfunction Index () {\n  const [showThreeViewer, setShowThreeViewer] = useState(true);\n  const [showViridisLegend, setShowViridisLegend] = useState(false);\n  window.setShowThreeViewer = setShowThreeViewer;\n  window.setShowViridisLegend = setShowViridisLegend;\n  window.showViridisLegend = showViridisLegend;\n  return (\n  <Main\n    description={'Berechne das Potential deiner Solaranlage.'}\n  >\n    <article className=\"post\" id=\"index\">\n      <header>\n        <div className=\"title\">\n          <SearchField/>\n          \n        </div>\n      </header>\n      {showThreeViewer && <ThreeViewer/>}\n      {showViridisLegend && <ViridisLegend/>}\n    </article>\n    \n  </Main>\n);\n  }\n\nexport default Index;\n"],"names":["scene","renderer","camera","controls","STLViewer","resetCamera","arguments","length","undefined","elem","document","getElementsByClassName","style","width","height","THREE","antialias","alpha","clientWidth","clientHeight","up","setSize","replaceChild","domElement","firstChild","window","addEventListener","aspect","updateProjectionMatrix","MapControls","mouseButtons","LEFT","PAN","MIDDLE","DOLLY","RIGHT","ROTATE","screenSpacePanning","maxPolarAngle","Math","PI","dirLight","position","set","add","dirLight2","dirLight3","subdivideTriangle","triangle","_triangle","_slicedToArray","v0","v1","v2","m01","vec3","m12","m20","adaptiveSubdivideMesh","triangles","threshold","_step","subdividedTrianglesList","_iterator","_createForOfIteratorHelper","s","n","done","trianglesToSubdivide","value","currentTriangle","pop","edge1","edge2","crossProduct","lengthEdge1","lengthEdge2","area","max","push","subdividedTriangles","apply","_toConsumableArray","err","e","f","addToArray","ar1","ar2","i","intensity_colormap","t","c0","c1","c2","c3","c4","c5","c6","rayTracingWebGL","pointsArray","trianglesArray","normals","num_dates","loc","N_TRIANGLES","N_POINTS","gl","getElementById","getContext","alert","vertexShaderSource","concat","program","vertexShader","fragmentShader","variables_of_interest","createProgram","setShowTooManyUniformsError","attachShader","transformFeedbackVaryings","SEPARATE_ATTRIBS","linkProgram","getProgramParameter","LINK_STATUS","console","error","getProgramInfoLog","deleteProgram","createShader","VERTEX_SHADER","FRAGMENT_SHADER","maxTextureSize","getParameter","MAX_TEXTURE_SIZE","textureWidth","min","floor","textureHeight","ceil","log","colorBuffer","makeBuffer","tf","buffer","createTransformFeedback","bindTransformFeedback","TRANSFORM_FEEDBACK","bindBufferBase","TRANSFORM_FEEDBACK_BUFFER","makeTransformFeedback","useProgram","alignedTrianglesArray","texture","createTexture","bindTexture","TEXTURE_2D","Float32Array","x","index","j","texImage2D","RGB32F","RGB","FLOAT","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","u_trianglesLocation","getUniformLocation","activeTexture","TEXTURE0","uniform1i","u_textureWidth","positionAttributeLocation","getAttribLocation","normalAttributeLocation","vao","createVertexArray","bindVertexArray","isShadowedArray","makeBufferAndSetAttribute","sunDirectionUniformLocation","sunDirection","retrieveRandomSunDirections","lat","lon","uniform3fv","drawArraysWithTransformFeedback","POINTS","getResults","filter","_","label","results","bindBuffer","ARRAY_BUFFER","getBufferSubData","type","source","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","sizeOrData","buf","createBuffer","bufferData","DYNAMIC_DRAW","data","enableVertexAttribArray","vertexAttribPointer","primitiveType","count","enable","RASTERIZER_DISCARD","beginTransformFeedback","drawArrays","endTransformFeedback","disable","raytracingGeometry","innerGeometry","outerGeometry","Ndates","directions","date","Date","random","pos","SunCalc","altitude","Number","NaN","cos","sin","azimuth","calc_webgl","_x","_x2","_calc_webgl","_asyncToGenerator","_regeneratorRuntime","mark","_callee","mesh_vectors","points","status_elem","uniquePoints","uniqueNormals","uniquePairs","point","pointKey","uniquePointsArray","uniqueNormalsArray","uniqueIntensities","_i","_point","_pointKey","intensities_array","_i2","_point2","_pointKey2","intensities","wrap","_context","prev","next","attributes","array","normal","textContent","hasChanged","map","parseFloat","toFixed","JSON","stringify","hasOwnProperty","slice","numSimulations","sent","setLoading","abrupt","Array","fill","showMeshIntensities","stop","refine_triangles","triangle_array","newpos_update","cutoffMesh","geometry","cutoff","posarray","newposarray","newnormals","keep","d1","d2","ar","new_geometry","setAttribute","needsUpdate","createMeshes","big_geometry","offset","cutoffRaytracing","numRadiusSimulation","outerCutoff","refinementCutoff","mesh_refinement_scale","xytranslate","minZ","POSITIVE_INFINITY","zcoord","getZ","centerMesh","loc_utm","geometryDict","adaptiveSubdivideThreshold","innerPosarray","innerNormals","outerPosarray","outerNormals","isInnerGeometry","_step2","triangle_points","_iterator2","splitCutoffRefineMesh","setShowErrorMessage","setShowThreeViewer","_x3","_x4","_showMeshIntensities","_callee3","oldCameraPosition","Npoints","newColors","col","material","mesh","outerGeometryMaterial","outerMesh","middle","animate","_context3","y","z","vertexColors","side","shininess","roughness","color","computeBoundingBox","boundingBox","getCenter","offsetPos","requestAnimationFrame","update","render","setShowViridisLegend","getLocationFromInput","_getLocationFromInput","locationText","_locationText$split$m","_locationText$split$m2","latitude","longitude","url","response","locationTextModified","test","split","trim","fetchLocation","join","_fetchLocation","_callee2","statuselem","responseData","_context2","fetch","ok","Error","status","json","t0","setLocation","_x5","_x6","_setLocation","inputValue","inputChanged","simulationParamChanged","newloc","mapLocationBaseChanged","mapLocation","mapLocationChanged","retrieveData","get_file_names","DIVISOR","BUFFER_ZONE","proj4","defs","_transformer$forward","forward","_transformer$forward2","x_utm32","y_utm32","x_rounded","y_rounded","load_tile_left","load_tile_right","load_tile_lower","load_tile_upper","file_list","getCommentLine","stlData","uint8Array","Uint8Array","commentChars","unshift","String","fromCharCode","commentLine","parseCommentLine","comment","match","_x7","_retrieveData","_callee4","baseurl","filenames","geometries","zipData","cached_file_found","main_offset","filename","filename_idx","zip","stlFile","local_offset","_args4","_context4","stlFiles","indexOf","stlDataCached","arrayBuffer","append","JSZip","loadAsync","file","Object","keys","files","async","STLLoader","parse","translate","BufferGeometryUtils","t1","finish","_jsxs","alignItems","children","_jsx","src","alt","maxWidth","override","display","margin","borderColor","_useState","useState","_useState2","setInputValue","_useState3","_useState4","loading","_useState5","_useState6","showErrorMessage","_useState7","_useState8","setInputChanged","_useState9","_useState10","showTooManyUniformsError","_Fragment","onSubmit","event","numRadiusSimulationChanged","numSimulationsChanged","preventDefault","placeholder","onChange","target","WrongAdress","TooManyUniforms","DotLoader","cssOverride","size","ThreeViewer","offsetPosition","setOffsetPosition","movePosition","distanceStep","direction","atan2","rotation","step","newPos","toString","lookAt","cylinder","cylinderHeight","fade","scale","lerp","setTimeout","remove","dispose","addLocationCylinder","className","Canvas","flat","linear","id","showViridisLegend","onClick","right","bottom","xmlns","viewBox","x1","y1","x2","y2","transform","stroke","strokeWidth","opacity","showThreeViewer","Main","description","SearchField","ViridisLegend"],"sourceRoot":""}